(()=>{"use strict";var t,e={5433:(t,e,i)=>{i.d(e,{QB:()=>r,Sn:()=>s});const r=i(1745).A,s={}},1745:(t,e,i)=>{i.d(e,{A:()=>Us});var r=i(9719),s=i(6356),a=i(797),n=i.n(a);function o(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class l{constructor(t=0){o(this,"_ptr",void 0),o(this,"_size",void 0),o(this,"_capacity",void 0),t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(0==this._capacity?l.DefaultSize:2*this._capacity),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let i=0;i<t;i++)this._ptr[i]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let i=this._size;i<t;i++)this._ptr[i]="function"==typeof e?JSON.parse(JSON.stringify(new e)):e;else for(let i=this._size;i<t;i++)this._ptr[i]=e;else{const e=this._size-t;this._ptr.splice(this._size-e,e)}this._size=t}insert(t,e,i){let r=t._index;const s=e._index,a=i._index,n=a-s;this.prepareCapacity(this._size+n);const o=this._size-r;if(o>0)for(let t=0;t<o;t++)this._ptr.splice(r+t,0,null);for(let t=s;t<a;t++,r++)this._ptr[r]=e._vector._ptr[t];this._size=this._size+n}remove(t){return!(t<0||this._size<=t||(this._ptr.splice(t,1),--this._size,0))}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new u(this,e))}prepareCapacity(t){t>this._capacity&&(0==this._capacity?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return 0==this._size?this.end():new u(this,0)}end(){return new u(this,this._size)}getOffset(t){const e=new l;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}}o(l,"DefaultSize",10);class u{constructor(t,e){o(this,"_index",void 0),o(this,"_vector",void 0),this._vector=null!=t?t:null,this._index=null!=e?e:0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new u(this._vector,this._index++)}decrement(){return new u(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}}let h;var d;(d=h||(h={})).csmVector=l,d.iterator=u;class g{append(t,e){return this.s+=void 0!==e?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return 0==this.s.length}constructor(t){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"s",void 0),this.s=t}}let c,_,m,p,f;!function(t){t.csmString=g}(c||(c={}));class v{static createIdInternal(t){return new v(t)}getString(){return this._id}isEqual(t){return"string"==typeof t?this._id.isEqual(t):t instanceof g?this._id.isEqual(t.s):t instanceof v&&this._id.isEqual(t._id.s)}isNotEqual(t){return"string"==typeof t?!this._id.isEqual(t):t instanceof g?!this._id.isEqual(t.s):t instanceof v&&!this._id.isEqual(t._id.s)}constructor(t){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"_id",void 0),this._id="string"!=typeof t?t:new g(t)}}!function(t){t.CubismId=v}(_||(_={}));class y{constructor(){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"_ids",void 0),this._ids=new l}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;return"string"!=typeof t?this.registerId(t.s):(null!=(e=this.findId(t))||(e=v.createIdInternal(t),this._ids.pushBack(e)),e)}getId(t){return this.registerId(t)}isExist(t){return"string"==typeof t?null!=this.findId(t):this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}!function(t){t.CubismIdManager=y}(m||(m={}));class S{constructor(){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"_tr",void 0),this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let i=0;i<4;++i)for(let s=0;s<4;++s)for(let a=0;a<4;++a)r[s+4*i]+=t[a+4*i]*e[s+4*a];for(let t=0;t<16;++t)i[t]=r[t]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);S.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);S.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){S.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new S;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}function b(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismMatrix44=S}(p||(p={}));class x{constructor(t,e,i,r){b(this,"x",void 0),b(this,"y",void 0),b(this,"width",void 0),b(this,"height",void 0),this.x=t,this.y=e,this.width=i,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}}function C(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.csmRect=x}(f||(f={}));class P{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){null!=this.getModel()&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.r=t,this._modelColor.g=e,this._modelColor.b=i,this._modelColor.a=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(t){const e=this.getModelColor();return e.a*=t,this.isPremultipliedAlpha()&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){C(this,"_mvpMatrix4x4",void 0),C(this,"_modelColor",void 0),C(this,"_isCulling",void 0),C(this,"_isPremultipliedAlpha",void 0),C(this,"_anisotropy",void 0),C(this,"_model",void 0),C(this,"_useHighPrecisionMask",void 0),this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new B,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new S,this._mvpMatrix4x4.loadIdentity()}}C(P,"staticRelease",void 0);let M,w=function(t){return t[t.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",t[t.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",t[t.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",t}({});class B{constructor(t=1,e=1,i=1,r=1){C(this,"r",void 0),C(this,"g",void 0),C(this,"b",void 0),C(this,"a",void 0),this.r=t,this.g=e,this.b=i,this.a=r}}class I{constructor(t,e){C(this,"_isUsing",void 0),C(this,"_clippingIdList",void 0),C(this,"_clippingIdCount",void 0),C(this,"_layoutChannelIndex",void 0),C(this,"_layoutBounds",void 0),C(this,"_allClippedDrawRect",void 0),C(this,"_matrixForMask",void 0),C(this,"_matrixForDraw",void 0),C(this,"_clippedDrawableIndexList",void 0),C(this,"_bufferIndex",void 0),this._clippingIdList=t,this._clippingIdCount=e,this._allClippedDrawRect=new x,this._layoutBounds=new x,this._clippedDrawableIndexList=[],this._matrixForMask=new S,this._matrixForDraw=new S,this._bufferIndex=0}release(){null!=this._layoutBounds&&(this._layoutBounds=null),null!=this._allClippedDrawRect&&(this._allClippedDrawRect=null),null!=this._clippedDrawableIndexList&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}}!function(t){t.CubismBlendMode=w,t.CubismRenderer=P,t.CubismTextureColor=B}(M||(M={}));const T=(t,e,i)=>{((t,e,i)=>{O.print(t,"[CSM]"+e,i)})(t,e+"\n",i)},V=t=>{console.assert(t)};let F,E,R,A,L,D,k;F=(t,...e)=>{T(ct.LogLevel_Verbose,"[V]"+t,e)},E=(t,...e)=>{T(ct.LogLevel_Debug,"[D]"+t,e)},R=(t,...e)=>{T(ct.LogLevel_Info,"[I]"+t,e)},A=(t,...e)=>{T(ct.LogLevel_Warning,"[W]"+t,e)},L=(t,...e)=>{T(ct.LogLevel_Error,"[E]"+t,e)};class O{static print(t,e,i){if(t<ht.getLoggingLevel())return;const r=ht.coreLogFunction;r&&r(e.replace(/\{(\d+)\}/g,((t,e)=>i[e])))}static dumpBytes(t,e,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(t,"\n"):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[255&e[r]]);this.print(t,"\n")}constructor(){}}function N(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismDebug=O}(D||(D={}));class j{constructor(t,e){N(this,"first",void 0),N(this,"second",void 0),this.first=null==t?null:t,this.second=null==e?null:e}}class z{constructor(t){N(this,"_keyValues",void 0),N(this,"_dummyValue",void 0),N(this,"_size",void 0),null!=t?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new j(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t){i=e;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(0==this._keyValues.length?(!e&&t<z.DefaultSize&&(t=z.DefaultSize),this._keyValues.length=t):(!e&&t<2*this._keyValues.length&&(t=2*this._keyValues.length),this._keyValues.length=t))}begin(){return new U(this,0)}end(){return new U(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new U(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)E("{0} ,",this._keyValues[t]),E("\n")}}N(z,"DefaultSize",10);class U{constructor(t,e){N(this,"_index",void 0),N(this,"_map",void 0),this._map=null!=t?t:new z,this._index=null!=e?e:0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new U(this._map,this._index++)}decrement(){const t=new U(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}!function(t){t.csmMap=z,t.csmPair=j,t.iterator=U}(k||(k={}));class X{static parseJsonObject(t,e){return Object.keys(t).forEach((i=>{if("boolean"==typeof t[i]){const r=Boolean(t[i]);e.put(i,new $(r))}else if("string"==typeof t[i]){const r=String(t[i]);e.put(i,new J(r))}else if("number"==typeof t[i]){const r=Number(t[i]);e.put(i,new W(r))}else t[i]instanceof Array?e.put(i,X.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,X.parseJsonObject(t[i],new tt)):null==t[i]?e.put(i,new K):e.put(i,t[i])})),e}static parseJsonArray(t){const e=new Q;return Object.keys(t).forEach((i=>{if("number"==typeof Number(i))if("boolean"==typeof t[i]){const r=Boolean(t[i]);e.add(new $(r))}else if("string"==typeof t[i]){const r=String(t[i]);e.add(new J(r))}else if("number"==typeof t[i]){const r=Number(t[i]);e.add(new W(r))}else t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new tt)):null==t[i]?e.add(new K):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new tt));else if(null==t[i])e.add(new K);else{const r=Array(t[i]);for(let t=0;t<r.length;t++)e.add(r[t])}})),e}}function Y(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const G="Error: type mismatch";class H{constructor(){Y(this,"_stringBuffer",void 0)}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new l){return t}getMap(t){return t}getValueByIndex(t){return H.errorValue.setErrorNotForClientCall(G)}getValueByString(t){return H.nullValue.setErrorNotForClientCall(G)}getKeys(){return H.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return Z.errorValue}static staticInitializeNotForClientCall(){$.trueValue=new $(!0),$.falseValue=new $(!1),H.errorValue=new Z("ERROR",!0),H.nullValue=new K,H.dummyKeys=new l}static staticReleaseNotForClientCall(){$.trueValue=null,$.falseValue=null,H.errorValue=null,H.nullValue=null,H.dummyKeys=null}}Y(H,"dummyKeys",void 0),Y(H,"errorValue",void 0),Y(H,"nullValue",void 0);class q{constructor(t,e){Y(this,"_parseCallback",X.parseJsonObject),Y(this,"_error",void 0),Y(this,"_lineCount",void 0),Y(this,"_root",void 0),this._error=null,this._lineCount=0,this._root=null,null!=t&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new q;return i.parseBytes(t,e,i._parseCallback)?i:(q.delete(i),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let t=0,r=e.length;t<r;++t)i+="%"+this.pad(e[t].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const r=new Array(1),s=q.arrayBufferToString(t);if(this._root=null==i?this.parseValue(s,e,0,r):i(JSON.parse(s),new tt),this._error){let t="\0";return t="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new J(t),R("{0}",this._root.getRawString()),!1}return null!=this._root||(this._root=new Z(new g(this._error),!1),!1)}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,r){if(this._error)return null;let s,a=null,n=i;for(;n<e;n++)switch(t[n]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const e=new Array(1);return s=rt(t.slice(n),e),r[0]=t.indexOf(e[0]),new W(s)}case'"':return new J(this.parseString(t,e,n+1,r));case"[":return a=this.parseArray(t,e,n+1,r),a;case"{":return a=this.parseObject(t,e,n+1,r),a;case"n":return n+3<e?(a=new K,r[0]=n+4):this._error="parse null",a;case"t":return n+3<e?(a=$.trueValue,r[0]=n+4):this._error="parse true",a;case"f":return n+4<e?(a=$.falseValue,r[0]=n+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return r[0]=n,null;case"\n":this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,i,r){if(this._error)return null;if(!t)return this._error="string is null",null;let s,a,n=i;const o=new g("");let l=i;for(;n<e;n++)switch(s=t[n],s){case'"':return r[0]=n+1,o.append(t.slice(l),n-l),o.s;case"//":if(n++,n-1>l&&o.append(t.slice(l),n-l),l=n+1,n<e)switch(a=t[n],a){case"\\":o.expansion(1,"\\");break;case'"':o.expansion(1,'"');break;case"/":o.expansion(1,"/");break;case"b":o.expansion(1,"\b");break;case"f":o.expansion(1,"\f");break;case"n":o.expansion(1,"\n");break;case"r":o.expansion(1,"\r");break;case"t":o.expansion(1,"\t");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,r){if(this._error)return null;if(!t)return this._error="buffer is null",null;const s=new tt;let a="",n=i,o="";const l=Array(1);let u=!1;for(;n<e;n++){t:for(;n<e;n++)switch(o=t[n],o){case'"':if(a=this.parseString(t,e,n+1,l),this._error)return null;n=l[0],u=!0;break t;case"}":return r[0]=n+1,s;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!u)return this._error="key not found",null;u=!1;t:for(;n<e;n++)switch(o=t[n],o){case":":u=!0,n++;break t;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!u)return this._error="':' not found",null;const i=this.parseValue(t,e,n,l);if(this._error)return null;n=l[0],s.put(a,i);t:for(;n<e;n++)switch(o=t[n],o){case",":break t;case"}":return r[0]=n+1,s;case"\n":this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,r){if(this._error)return null;if(!t)return this._error="buffer is null",null;let s,a=new Q,n=i;const o=new Array(1);for(;n<e;n++){const i=this.parseValue(t,e,n,o);if(this._error)return null;n=o[0],i&&a.add(i);t:for(;n<e;n++)switch(s=t[n],s){case",":break t;case"]":return r[0]=n+1,a;case"\n":++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class W extends H{constructor(t){super(),Y(this,"_value",void 0),this._value=t}isFloat(){return!0}getString(t,e){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return"number"==typeof t&&!Math.round(t)&&t==this._value}}class $ extends H{isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return"boolean"==typeof t&&t==this._boolValue}isStatic(){return!0}constructor(t){super(),Y(this,"_boolValue",void 0),this._boolValue=t}}Y($,"trueValue",void 0),Y($,"falseValue",void 0);class J extends H{constructor(t){super(),"string"==typeof t&&(this._stringBuffer=t),t instanceof g&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return"string"==typeof t?this._stringBuffer==t:t instanceof g&&this._stringBuffer==t.s}}class Z extends J{isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}constructor(t,e){super(t),Y(this,"_isStatic",void 0),this._isStatic=e}isError(){return!0}}class K extends H{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,Z.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class Q extends H{constructor(){super(),Y(this,"_array",void 0),this._array=new l}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return H.errorValue.setErrorNotForClientCall("Error: index out of bounds");const e=this._array.at(t);return null==e?H.nullValue:e}getValueByString(t){return H.errorValue.setErrorNotForClientCall(G)}getString(t,e){const i=e+"[\n";for(let t=this._array.begin();t.notEqual(this._array.end());t.increment()){const i=t.ptr();this._stringBuffer+=e+""+i.getString(e+" ")+"\n"}return this._stringBuffer=i+e+"]\n",this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class tt extends H{constructor(){super(),Y(this,"_map",void 0),Y(this,"_keys",void 0),this._map=new z}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof g){const e=this._map.getValue(t.s);return null==e?H.nullValue:e}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return null==e.ptr().second?H.nullValue:e.ptr().second;return H.nullValue}getValueByIndex(t){return H.errorValue.setErrorNotForClientCall(G)}getString(t,e){this._stringBuffer=e+"{\n";const i=this._map.begin();for(;i.notEqual(this._map.end());){const t=i.ptr().first,r=i.ptr().second;this._stringBuffer+=e+" "+t+" : "+r.getString(e+"   ")+" \n",i.preIncrement()}return this._stringBuffer+=e+"}\n",this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new l;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}let et;function it(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function rt(t,e){let i=0;for(let e=1;;e++){const r=t.slice(e-1,e);if("e"==r||"-"==r||"E"==r)continue;const s=t.substring(0,e),a=Number(s);if(isNaN(a))break;i=e}let r=parseFloat(t);return isNaN(r)&&(r=NaN),e[0]=t.slice(i),r}!function(t){t.CubismJson=q,t.JsonArray=Q,t.JsonBoolean=$,t.JsonError=Z,t.JsonFloat=W,t.JsonMap=tt,t.JsonNullvalue=K,t.JsonString=J,t.Value=H}(et||(et={}));let st=!1,at=!1,nt=null,ot=null;const lt=Object.freeze({vertexOffset:0,vertexStep:2});function ut(t){t&&(t=void 0)}class ht{static startUp(t=null){if(st)return R("CubismFramework.startUp() is already done."),st;if(nt=t,null!=nt&&Live2DCubismCore.Logging.csmSetLogFunction(nt.logFunction),st=!0,st){const t=Live2DCubismCore.Version.csmGetVersion(),e=(16711680&t)>>16,i=65535&t,r=t;R("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+((4278190080&t)>>24)).slice(-2),("00"+e).slice(-2),("0000"+i).slice(-4),r)}return R("CubismFramework.startUp() is complete."),st}static cleanUp(){st=!1,at=!1,nt=null,ot=null}static initialize(t=0){V(st),st?at?A("CubismFramework.initialize() skipped, already initialized."):(H.staticInitializeNotForClientCall(),ot=new y,Live2DCubismCore.Memory.initializeAmountOfMemory(t),at=!0,R("CubismFramework.initialize() is complete.")):A("CubismFramework is not started.")}static dispose(){V(st),st?at?(H.staticReleaseNotForClientCall(),ot.release(),ot=null,P.staticRelease(),at=!1,R("CubismFramework.dispose() is complete.")):A("CubismFramework.dispose() skipped, not initialized."):A("CubismFramework is not started.")}static isStarted(){return st}static isInitialized(){return at}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return null!=nt?nt.loggingLevel:ct.LogLevel_Off}static getIdManager(){return ot}constructor(){}}class dt{constructor(){it(this,"logFunction",void 0),it(this,"loggingLevel",void 0)}}let gt,ct=function(t){return t[t.LogLevel_Verbose=0]="LogLevel_Verbose",t[t.LogLevel_Debug=1]="LogLevel_Debug",t[t.LogLevel_Info=2]="LogLevel_Info",t[t.LogLevel_Warning=3]="LogLevel_Warning",t[t.LogLevel_Error=4]="LogLevel_Error",t[t.LogLevel_Off=5]="LogLevel_Off",t}({});!function(t){t.Constant=lt,t.csmDelete=ut,t.CubismFramework=ht}(gt||(gt={}));let _t="",mt="",pt="";const ft="Head",vt="Body",yt=ct.LogLevel_Verbose;let St=null,bt=null,xt=null;class Ct{static getInstance(t){return null==xt&&(xt=new Ct(t)),xt}static releaseInstance(){null!=xt&&xt.release(),xt=null}constructor(t){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"_canvasSelfCreated",!1),this._canvasSelfCreated=!t,St=null!=t?t:document.createElement("canvas"),bt=St.getContext("webgl2",{}),bt||(alert("Cannot initialize WebGL. This browser does not support."),bt=null,document.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.")}release(){this._canvasSelfCreated&&St&&St.remove(),this._canvasSelfCreated=!1}}const Pt=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});let Mt,wt;!function(t){t.HitAreaBody=Pt.HitAreaBody,t.HitAreaHead=Pt.HitAreaHead,t.HitAreaPrefix=Pt.HitAreaPrefix,t.ParamAngleX=Pt.ParamAngleX,t.ParamAngleY=Pt.ParamAngleY,t.ParamAngleZ=Pt.ParamAngleZ,t.ParamArmLA=Pt.ParamArmLA,t.ParamArmLB=Pt.ParamArmLB,t.ParamArmRA=Pt.ParamArmRA,t.ParamArmRB=Pt.ParamArmRB,t.ParamBaseX=Pt.ParamBaseX,t.ParamBaseY=Pt.ParamBaseY,t.ParamBodyAngleX=Pt.ParamBodyAngleX,t.ParamBodyAngleY=Pt.ParamBodyAngleY,t.ParamBodyAngleZ=Pt.ParamBodyAngleZ,t.ParamBreath=Pt.ParamBreath,t.ParamBrowLAngle=Pt.ParamBrowLAngle,t.ParamBrowLForm=Pt.ParamBrowLForm,t.ParamBrowLX=Pt.ParamBrowLX,t.ParamBrowLY=Pt.ParamBrowLY,t.ParamBrowRAngle=Pt.ParamBrowRAngle,t.ParamBrowRForm=Pt.ParamBrowRForm,t.ParamBrowRX=Pt.ParamBrowRX,t.ParamBrowRY=Pt.ParamBrowRY,t.ParamBustX=Pt.ParamBustX,t.ParamBustY=Pt.ParamBustY,t.ParamCheek=Pt.ParamCheek,t.ParamEyeBallForm=Pt.ParamEyeBallForm,t.ParamEyeBallX=Pt.ParamEyeBallX,t.ParamEyeBallY=Pt.ParamEyeBallY,t.ParamEyeLOpen=Pt.ParamEyeLOpen,t.ParamEyeLSmile=Pt.ParamEyeLSmile,t.ParamEyeROpen=Pt.ParamEyeROpen,t.ParamEyeRSmile=Pt.ParamEyeRSmile,t.ParamHairBack=Pt.ParamHairBack,t.ParamHairFluffy=Pt.ParamHairFluffy,t.ParamHairFront=Pt.ParamHairFront,t.ParamHairSide=Pt.ParamHairSide,t.ParamHandL=Pt.ParamHandL,t.ParamHandR=Pt.ParamHandR,t.ParamMouthForm=Pt.ParamMouthForm,t.ParamMouthOpenY=Pt.ParamMouthOpenY,t.ParamNONE=Pt.ParamNONE,t.ParamShoulderY=Pt.ParamShoulderY,t.PartsArmLPrefix=Pt.PartsArmLPrefix,t.PartsArmPrefix=Pt.PartsArmPrefix,t.PartsArmRPrefix=Pt.PartsArmRPrefix,t.PartsIdCore=Pt.PartsIdCore}(Mt||(Mt={}));class Bt{}function It(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.ICubismModelSetting=Bt}(wt||(wt={}));const Tt="FileReferences",Vt="UserData",Ft="Name",Et="File",Rt="Ids",At="Sound",Lt="FadeInTime",Dt="FadeOutTime",kt="LipSync",Ot="EyeBlink";var Nt=function(t){return t[t.FrequestNode_Groups=0]="FrequestNode_Groups",t[t.FrequestNode_Moc=1]="FrequestNode_Moc",t[t.FrequestNode_Motions=2]="FrequestNode_Motions",t[t.FrequestNode_Expressions=3]="FrequestNode_Expressions",t[t.FrequestNode_Textures=4]="FrequestNode_Textures",t[t.FrequestNode_Physics=5]="FrequestNode_Physics",t[t.FrequestNode_Pose=6]="FrequestNode_Pose",t[t.FrequestNode_HitAreas=7]="FrequestNode_HitAreas",t}(Nt||{});class jt extends Bt{constructor(t,e){super(),It(this,"_json",void 0),It(this,"_jsonValue",void 0),this._json=q.create(t,e),this.getJson()&&(this._jsonValue=new l,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString("Groups")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(Tt).getValueByString("Moc")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(Tt).getValueByString("Motions")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(Tt).getValueByString("Expressions")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(Tt).getValueByString("Textures")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(Tt).getValueByString("Physics")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(Tt).getValueByString("Pose")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString("HitAreas")))}release(){q.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(Nt.FrequestNode_Moc).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(Nt.FrequestNode_Textures).getSize():0}getTextureDirectory(){const t=this._jsonValue.at(Nt.FrequestNode_Textures).getValueByIndex(0).getRawString().split("/"),e=t.length-1;let i="";for(let r=0;r<e;r++)i+=t[r],r<e-1&&(i+="/");return i}getTextureFileName(t){return this._jsonValue.at(Nt.FrequestNode_Textures).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(Nt.FrequestNode_HitAreas).getSize():0}getHitAreaId(t){return ht.getIdManager().getId(this._jsonValue.at(Nt.FrequestNode_HitAreas).getValueByIndex(t).getValueByString("Id").getRawString())}getHitAreaName(t){return this._jsonValue.at(Nt.FrequestNode_HitAreas).getValueByIndex(t).getValueByString(Ft).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(Nt.FrequestNode_Physics).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(Nt.FrequestNode_Pose).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(Nt.FrequestNode_Expressions).getSize():0}getExpressionName(t){return this._jsonValue.at(Nt.FrequestNode_Expressions).getValueByIndex(t).getValueByString(Ft).getRawString()}getExpressionFileName(t){return this._jsonValue.at(Nt.FrequestNode_Expressions).getValueByIndex(t).getValueByString(Et).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(Nt.FrequestNode_Motions).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(Nt.FrequestNode_Motions).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(Et).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(At).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(Lt).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(Dt).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(Tt).getValueByString(Vt).getRawString():""}getLayoutMap(t){const e=this.getJson().getRoot().getValueByString("Layout").getMap();if(null==e)return!1;let i=!1;for(const r=e.begin();r.notEqual(e.end());r.preIncrement())t.setValue(r.ptr().first,r.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(Nt.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(Nt.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(Ft).getRawString()==Ot){t=i.getValueByString(Rt).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(Nt.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(Nt.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(Ft).getRawString()==Ot)return ht.getIdManager().getId(i.getValueByString(Rt).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(Nt.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(Nt.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(Ft).getRawString()==kt){t=i.getValueByString(Rt).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(Nt.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(Nt.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(Ft).getRawString()==kt)return ht.getIdManager().getId(i.getValueByString(Rt).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(Nt.FrequestNode_Moc);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(Nt.FrequestNode_Textures);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(Nt.FrequestNode_HitAreas);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(Nt.FrequestNode_Physics);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(Nt.FrequestNode_Pose);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(Nt.FrequestNode_Expressions);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(Nt.FrequestNode_Motions);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(At);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(Lt);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(Nt.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(Dt);return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this.getJson().getRoot().getValueByString(Tt).getValueByString(Vt);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(Nt.FrequestNode_Groups).isNull()||this._jsonValue.at(Nt.FrequestNode_Groups).isError())return!1;for(let t=0;t<this._jsonValue.at(Nt.FrequestNode_Groups).getSize();++t)if(this._jsonValue.at(Nt.FrequestNode_Groups).getValueByIndex(t).getValueByString(Ft).getRawString()==Ot)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(Nt.FrequestNode_Groups).isNull()||this._jsonValue.at(Nt.FrequestNode_Groups).isError())return!1;for(let t=0;t<this._jsonValue.at(Nt.FrequestNode_Groups).getSize();++t)if(this._jsonValue.at(Nt.FrequestNode_Groups).getValueByIndex(t).getValueByString(Ft).getRawString()==kt)return!0;return!1}}let zt,Ut;function Xt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismModelSettingJson=jt}(zt||(zt={}));class Yt{static create(){return new Yt}static delete(t){null!=t&&(t=null)}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=2*this._currentTime*3.14159;for(let e=0;e<this._breathParameters.getSize();++e){const r=this._breathParameters.at(e);t.addParameterValueById(r.parameterId,r.offset+r.peak*Math.sin(i/r.cycle),r.weight)}}constructor(){Xt(this,"_breathParameters",void 0),Xt(this,"_currentTime",void 0),this._currentTime=0}}class Gt{constructor(t,e,i,r,s){Xt(this,"parameterId",void 0),Xt(this,"offset",void 0),Xt(this,"peak",void 0),Xt(this,"cycle",void 0),Xt(this,"weight",void 0),this.parameterId=null==t?null:t,this.offset=null==e?0:e,this.peak=null==i?0:i,this.cycle=null==r?0:r,this.weight=null==s?0:s}}function Ht(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.BreathParameterData=Gt,t.CubismBreath=Yt}(Ut||(Ut={}));class qt{static create(t=null){return new qt(t)}static delete(t){null!=t&&(t=null)}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){let i;this._userTimeSeconds+=e;let r=0;switch(this._blinkingState){case $t.EyeState_Closing:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=$t.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case $t.EyeState_Closed:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=$t.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case $t.EyeState_Opening:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=$t.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case $t.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=$t.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case $t.EyeState_First:default:this._blinkingState=$t.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1}qt.CloseIfZero||(i=-i);for(let e=0;e<this._parameterIds.getSize();++e)t.setParameterValueById(this._parameterIds.at(e),i)}constructor(t){if(Ht(this,"_blinkingState",void 0),Ht(this,"_parameterIds",void 0),Ht(this,"_nextBlinkingTime",void 0),Ht(this,"_stateStartTimeSeconds",void 0),Ht(this,"_blinkingIntervalSeconds",void 0),Ht(this,"_closingSeconds",void 0),Ht(this,"_closedSeconds",void 0),Ht(this,"_openingSeconds",void 0),Ht(this,"_userTimeSeconds",void 0),this._blinkingState=$t.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new l,null!=t)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}}Ht(qt,"CloseIfZero",!0);let Wt,$t=function(t){return t[t.EyeState_First=0]="EyeState_First",t[t.EyeState_Interval=1]="EyeState_Interval",t[t.EyeState_Closing=2]="EyeState_Closing",t[t.EyeState_Closed=3]="EyeState_Closed",t[t.EyeState_Opening=4]="EyeState_Opening",t}({});function Jt(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismEyeBlink=qt,t.EyeState=$t}(Wt||(Wt={}));const Zt="FadeInTime",Kt="Link";class Qt{static create(t,e){const i=q.create(t,e);if(!i)return null;const r=new Qt,s=i.getRoot();s.getValueByString(Zt).isNull()||(r._fadeTimeSeconds=s.getValueByString(Zt).toFloat(.5),r._fadeTimeSeconds<=0&&(r._fadeTimeSeconds=.5));const a=s.getValueByString("Groups"),n=a.getSize();for(let t=0;t<n;++t){const e=a.getValueByIndex(t),i=e.getSize();let s=0;for(let t=0;t<i;++t){const i=e.getValueByIndex(t),a=new te,n=ht.getIdManager().getId(i.getValueByString("Id").getRawString());if(a.partId=n,!i.getValueByString(Kt).isNull()){const t=i.getValueByString(Kt),e=t.getSize();for(let i=0;i<e;++i){const e=new te,r=ht.getIdManager().getId(t.getValueByIndex(i).getString());e.partId=r,a.link.pushBack(e)}}r._partGroups.pushBack(a.clone()),++s}r._partGroupCounts.pushBack(s)}return q.delete(i),r}static delete(t){null!=t&&(t=null)}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let r=0;r<this._partGroupCounts.getSize();r++){const s=this._partGroupCounts.at(r);this.doFade(t,e,i,s),i+=s}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const r=this._partGroupCounts.at(i);for(let i=e;i<e+r;++i){this._partGroups.at(i).initialize(t);const r=this._partGroups.at(i).partIndex,s=this._partGroups.at(i).parameterIndex;if(!(r<0)){t.setPartOpacityByIndex(r,i==e?1:0),t.setParameterValueByIndex(s,i==e?1:0);for(let e=0;e<this._partGroups.at(i).link.getSize();++e)this._partGroups.at(i).link.at(e).initialize(t)}}e+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(0==i.link.getSize())continue;const r=this._partGroups.at(e).partIndex,s=t.getPartOpacityByIndex(r);for(let e=0;e<i.link.getSize();++e){const r=i.link.at(e).partIndex;r<0||t.setPartOpacityByIndex(r,s)}}}doFade(t,e,i,r){let s=-1,a=1;for(let n=i;n<i+r;++n){const i=this._partGroups.at(n).partIndex,r=this._partGroups.at(n).parameterIndex;if(t.getParameterValueByIndex(r)>.001){if(s>=0)break;s=n,a=t.getPartOpacityByIndex(i),a+=e/this._fadeTimeSeconds,a>1&&(a=1)}}s<0&&(s=0,a=1);for(let e=i;e<i+r;++e){const i=this._partGroups.at(e).partIndex;if(s==e)t.setPartOpacityByIndex(i,a);else{let e,r=t.getPartOpacityByIndex(i);e=a<.5?-.5*a/.5+1:.5*(1-a)/.5,(1-e)*(1-a)>.15&&(e=1-.15/(1-a)),r>e&&(r=e),t.setPartOpacityByIndex(i,r)}}}constructor(){Jt(this,"_partGroups",void 0),Jt(this,"_partGroupCounts",void 0),Jt(this,"_fadeTimeSeconds",void 0),Jt(this,"_lastModel",void 0),this._fadeTimeSeconds=.5,this._lastModel=null,this._partGroups=new l,this._partGroupCounts=new l}}class te{constructor(t){if(Jt(this,"partId",void 0),Jt(this,"parameterIndex",void 0),Jt(this,"partIndex",void 0),Jt(this,"link",void 0),this.parameterIndex=0,this.partIndex=0,this.link=new l,null!=t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new te;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new l;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}let ee,ie,re;function se(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismPose=Qt,t.PartData=te}(ee||(ee={}));class ae extends S{constructor(t,e){super(),se(this,"_width",void 0),se(this,"_height",void 0),this._width=void 0!==t?t:0,this._height=void 0!==e?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"width"==t?this.setWidth(i):"height"==t&&this.setHeight(i)}for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"x"==t?this.setX(i):"y"==t?this.setY(i):"center_x"==t?this.centerX(i):"center_y"==t?this.centerY(i):"top"==t?this.top(i):"bottom"==t?this.bottom(i):"left"==t?this.left(i):"right"==t&&this.right(i)}}}!function(t){t.CubismModelMatrix=ae}(ie||(ie={}));class ne{constructor(t,e){this.x=t,this.y=e,this.x=null==t?0:t,this.y=null==e?0:e}add(t){const e=new ne(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new ne(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new ne(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new ne(t,t))}division(t){const e=new ne(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new ne(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}!function(t){t.CubismVector2=ne}(re||(re={}));class oe{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(0===t)return t;let e=t;const i=e<0;let r;return i&&(e=-e),e===1/0?r=1/0:(r=Math.exp(Math.log(e)/3),r=(e/(r*r)+2*r)/3),i?-r:r}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return 180*t/Math.PI}static directionToRadian(t,e){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let r=this.radianToDegrees(i);return e.x-t.x>0&&(r=-r),r}static radianToDirection(t){const e=new ne;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<oe.Epsilon?this.abs(e)<oe.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,r){if(this.sqrt(t)<oe.Epsilon)return this.range(this.quadraticEquation(e,i,r),0,1);const s=e/t,a=i/t,n=(3*a-s*s)/3,o=n/3,l=(2*s*s*s-9*s*a+r/t*27)/27,u=l/2,h=u*u+o*o*o,d=.51;if(h<0){const t=-n/3,e=t*t*t,i=this.sqrt(e),r=-l/(2*i),a=this.range(r,-1,1),o=Math.acos(a),u=2*this.cbrt(i),h=u*this.cos(o/3)-s/3;if(this.abs(h-.5)<d)return this.range(h,0,1);const g=u*this.cos((o+2*Math.PI)/3)-s/3;if(this.abs(g-.5)<d)return this.range(g,0,1);const c=u*this.cos((o+4*Math.PI)/3)-s/3;return this.range(c,0,1)}if(0==h){let t;t=u<0?this.cbrt(-u):-this.cbrt(u);const e=2*t-s/3;if(this.abs(e-.5)<d)return this.range(e,0,1);const i=-t-s/3;return this.range(i,0,1)}const g=this.sqrt(h),c=this.cbrt(g-u)-this.cbrt(g+u)-s/3;return this.range(c,0,1)}static mod(t,e){if(!isFinite(t)||0===e||isNaN(t)||isNaN(e))return console.warn(`divided: ${t}, divisor: ${e} mod() returns 'NaN'.`),NaN;const i=Math.abs(t),r=Math.abs(e);let s=i-Math.floor(i/r)*r;return s*=Math.sign(t),s}constructor(){}}var le,ue,he;let de,ge,ce;function _e(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}le=oe,he=1e-5,(ue=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(ue="Epsilon"))in le?Object.defineProperty(le,ue,{value:he,enumerable:!0,configurable:!0,writable:!0}):le[ue]=he,function(t){t.CubismMath=oe}(de||(de={}));class me{constructor(){_e(this,"_faceTargetX",void 0),_e(this,"_faceTargetY",void 0),_e(this,"_faceX",void 0),_e(this,"_faceY",void 0),_e(this,"_faceVX",void 0),_e(this,"_faceVY",void 0),_e(this,"_lastTimeSeconds",void 0),_e(this,"_userTimeSeconds",void 0),this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const e=4/30;if(0==this._lastTimeSeconds)return void(this._lastTimeSeconds=this._userTimeSeconds);const i=30*(this._userTimeSeconds-this._lastTimeSeconds);this._lastTimeSeconds=this._userTimeSeconds;const r=i*e/4.5,s=this._faceTargetX-this._faceX,a=this._faceTargetY-this._faceY;if(oe.abs(s)<=.01&&oe.abs(a)<=.01)return;const n=oe.sqrt(s*s+a*a),o=e*a/n;let l=e*s/n-this._faceVX,u=o-this._faceVY;const h=oe.sqrt(l*l+u*u);(h<-r||h>r)&&(l*=r/h,u*=r/h),this._faceVX+=l,this._faceVY+=u;{const t=.5*(oe.sqrt(r*r+16*r*n-8*r*n)-r),e=oe.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);e>t&&(this._faceVX*=t/e,this._faceVY*=t/e)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}function pe(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismTargetPoint=me}(ge||(ge={}));class fe{static delete(t){t.release(),t=null}constructor(){pe(this,"setFinishedMotionHandler",(t=>this._onFinishedMotion=t)),pe(this,"getFinishedMotionHandler",(()=>this._onFinishedMotion)),pe(this,"_fadeInSeconds",void 0),pe(this,"_fadeOutSeconds",void 0),pe(this,"_weight",void 0),pe(this,"_offsetSeconds",void 0),pe(this,"_firedEventValues",void 0),pe(this,"_onFinishedMotion",void 0),this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new l}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;this.setupMotionQueueEntry(e,i);const r=this.updateFadeWeight(e,i);this.doUpdateParameters(t,i,r,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setupMotionQueueEntry(t,e){if(null==t||t.isStarted())return;if(!t.isAvailable())return;t.setIsStarted(!0),t.setStartTime(e-this._offsetSeconds),t.setFadeInStartTime(e);const i=this.getDuration();t.getEndTime()<0&&t.setEndTime(i<=0?-1:t.getStartTime()+i)}updateFadeWeight(t,e){null==t&&O.print(ct.LogLevel_Error,"motionQueueEntry is null.");let i=this._weight;return i=i*(0==this._fadeInSeconds?1:oe.getEasingSine((e-t.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||t.getEndTime()<0?1:oe.getEasingSine((t.getEndTime()-e)/this._fadeOutSeconds)),t.setState(e,i),V(0<=i&&i<=1),i}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){return null}getModelOpacityValue(){return 1}}function ve(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.ACubismMotion=fe}(ce||(ce={}));const ye="Parameters",Se="Blend";class be extends fe{static create(t,e){const i=new be;return i.parse(t,e),i}doUpdateParameters(t,e,i,r){for(let e=0;e<this._parameters.getSize();++e){const r=this._parameters.at(e);switch(r.blendType){case Pe.Additive:t.addParameterValueById(r.parameterId,r.value,i);break;case Pe.Multiply:t.multiplyParameterValueById(r.parameterId,r.value,i);break;case Pe.Overwrite:t.setParameterValueById(r.parameterId,r.value,i)}}}calculateExpressionParameters(t,e,i,r,s,a){if(null!=i&&null!=r&&i.isAvailable()){this._fadeWeight=this.updateFadeWeight(i,e);for(let e=0;e<r.getSize();++e){const i=r.at(e);if(null==i.parameterId)continue;const n=i.overwriteValue=t.getParameterValueById(i.parameterId),o=this.getExpressionParameters();let l=-1;for(let t=0;t<o.getSize();++t)if(i.parameterId==o.at(t).parameterId){l=t;break}if(l<0){0==s?(i.additiveValue=be.DefaultAdditiveValue,i.multiplyValue=be.DefaultMultiplyValue,i.overwriteValue=n):(i.additiveValue=this.calculateValue(i.additiveValue,be.DefaultAdditiveValue,a),i.multiplyValue=this.calculateValue(i.multiplyValue,be.DefaultMultiplyValue,a),i.overwriteValue=this.calculateValue(i.overwriteValue,n,a));continue}const u=o.at(l).value;let h,d,g;switch(o.at(l).blendType){case Pe.Additive:h=u,d=be.DefaultMultiplyValue,g=n;break;case Pe.Multiply:h=be.DefaultAdditiveValue,d=u,g=n;break;case Pe.Overwrite:h=be.DefaultAdditiveValue,d=be.DefaultMultiplyValue,g=u;break;default:return}0==s?(i.additiveValue=h,i.multiplyValue=d,i.overwriteValue=g):(i.additiveValue=i.additiveValue*(1-a)+h*a,i.multiplyValue=i.multiplyValue*(1-a)+d*a,i.overwriteValue=i.overwriteValue*(1-a)+g*a)}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(t,e){const i=q.create(t,e);if(!i)return;const r=i.getRoot();this.setFadeInTime(r.getValueByString("FadeInTime").toFloat(1)),this.setFadeOutTime(r.getValueByString("FadeOutTime").toFloat(1));const s=r.getValueByString(ye).getSize();this._parameters.prepareCapacity(s);for(let t=0;t<s;++t){const e=r.getValueByString(ye).getValueByIndex(t),i=ht.getIdManager().getId(e.getValueByString("Id").getRawString()),s=e.getValueByString("Value").toFloat();let a;a=e.getValueByString(Se).isNull()||"Add"==e.getValueByString(Se).getString()?Pe.Additive:"Multiply"==e.getValueByString(Se).getString()?Pe.Multiply:"Overwrite"==e.getValueByString(Se).getString()?Pe.Overwrite:Pe.Additive;const n=new Me;n.parameterId=i,n.blendType=a,n.value=s,this._parameters.pushBack(n)}q.delete(i)}calculateValue(t,e,i){return t*(1-i)+e*i}constructor(){super(),ve(this,"_parameters",void 0),ve(this,"_fadeWeight",void 0),this._parameters=new l,this._fadeWeight=0}}ve(be,"DefaultAdditiveValue",0),ve(be,"DefaultMultiplyValue",1);let xe,Ce,Pe=function(t){return t[t.Additive=0]="Additive",t[t.Multiply=1]="Multiply",t[t.Overwrite=2]="Overwrite",t}({});class Me{constructor(){ve(this,"parameterId",void 0),ve(this,"blendType",void 0),ve(this,"value",void 0)}}function we(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismExpressionMotion=be,t.ExpressionBlendType=Pe,t.ExpressionParameter=Me}(xe||(xe={}));class Be{constructor(){we(this,"_autoDelete",void 0),we(this,"_motion",void 0),we(this,"_available",void 0),we(this,"_finished",void 0),we(this,"_started",void 0),we(this,"_startTimeSeconds",void 0),we(this,"_fadeInStartTimeSeconds",void 0),we(this,"_endTimeSeconds",void 0),we(this,"_stateTimeSeconds",void 0),we(this,"_stateWeight",void 0),we(this,"_lastEventCheckSeconds",void 0),we(this,"_fadeOutSeconds",void 0),we(this,"_isTriggeredFadeOut",void 0),we(this,"_motionQueueEntryHandle",void 0),this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&fe.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}}function Ie(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismMotionQueueEntry=Be}(Ce||(Ce={}));class Te{constructor(){Ie(this,"_userTimeSeconds",void 0),Ie(this,"_motions",void 0),Ie(this,"_eventCallBack",void 0),Ie(this,"_eventCustomData",void 0),this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new l}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(null==t)return Ve;let r=null;for(let t=0;t<this._motions.getSize();++t)r=this._motions.at(t),null!=r&&r.setFadeOut(r._motion.getFadeOutTime());return r=new Be,r._autoDelete=e,r._motion=t,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null!=e)if(null!=e._motion){if(!e.isFinished())return!1;t.preIncrement()}else e.release(),e=null,t=this._motions.erase(t);else t=this._motions.erase(t)}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(null!=i&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();null!=e?(e.release(),e=null,t=this._motions.erase(t)):t=this._motions.erase(t)}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(null!=i&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let s=r.ptr();if(null==s){r=this._motions.erase(r);continue}const a=s._motion;if(null==a){s.release(),s=null,r=this._motions.erase(r);continue}a.updateParameters(t,s,e),i=!0;const n=a.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),e-s.getStartTime());for(let t=0;t<n.getSize();++t)this._eventCallBack(this,n.at(t),this._eventCustomData);s.setLastCheckEventSeconds(e),s.isFinished()?(s.release(),s=null,r=this._motions.erase(r)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),e),r.preIncrement())}return i}}const Ve=-1;let Fe,Ee;function Re(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismMotionQueueManager=Te,t.InvalidMotionQueueEntryHandleValue=Ve}(Fe||(Fe={}));class Ae{constructor(){Re(this,"parameterId",void 0),Re(this,"additiveValue",void 0),Re(this,"multiplyValue",void 0),Re(this,"overwriteValue",void 0)}}class Le extends Te{constructor(){super(),Re(this,"_expressionParameterValues",void 0),Re(this,"_fadeWeights",void 0),Re(this,"_currentPriority",void 0),Re(this,"_reservePriority",void 0),Re(this,"_startExpressionTime",void 0),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new l,this._fadeWeights=new l}release(){this._expressionParameterValues&&(ut(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&(ut(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}getFadeWeight(t){return this._fadeWeights.at(t)}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=i,this._fadeWeights.pushBack(0),this.startMotion(t,e)}updateMotion(t,e){this._userTimeSeconds+=e;let i=!1;const r=this.getCubismMotionQueueEntries();let s=0,a=0;for(let e=this._motions.begin();e.notEqual(this._motions.end());){const n=e.ptr();if(null==n){e=r.erase(e);continue}const o=n.getCubismMotion();if(null==o){ut(n),e=r.erase(e);continue}const l=o.getExpressionParameters();if(n.isAvailable())for(let e=0;e<l.getSize();++e){if(null==l.at(e).parameterId)continue;let i=-1;for(let t=0;t<this._expressionParameterValues.getSize();++t)if(this._expressionParameterValues.at(t).parameterId==l.at(e).parameterId){i=t;break}if(i>=0)continue;const r=new Ae;r.parameterId=l.at(e).parameterId,r.additiveValue=be.DefaultAdditiveValue,r.multiplyValue=be.DefaultMultiplyValue,r.overwriteValue=t.getParameterValueById(r.parameterId),this._expressionParameterValues.pushBack(r)}o.setupMotionQueueEntry(n,this._userTimeSeconds),this._fadeWeights.set(a,o.updateFadeWeight(n,this._userTimeSeconds)),o.calculateExpressionParameters(t,this._userTimeSeconds,n,this._expressionParameterValues,a,this._fadeWeights.at(a)),s+=0==o.getFadeInTime()?1:oe.getEasingSine((this._userTimeSeconds-n.getFadeInStartTime())/o.getFadeInTime()),i=!0,n.isTriggeredFadeOut()&&n.startFadeOut(n.getFadeOutSeconds(),this._userTimeSeconds),e.preIncrement(),++a}if(r.getSize()>1&&(r.at(r.getSize()-1).getCubismMotion(),this._fadeWeights.at(this._fadeWeights.getSize()-1)>=1))for(let t=r.getSize()-2;t>=0;--t)ut(r.at(t)),r.remove(t),this._fadeWeights.remove(t);s>1&&(s=1);for(let e=0;e<this._expressionParameterValues.getSize();++e){const i=this._expressionParameterValues.at(e);t.setParameterValueById(i.parameterId,(i.overwriteValue+i.additiveValue)*i.multiplyValue,s),i.additiveValue=be.DefaultAdditiveValue,i.multiplyValue=be.DefaultMultiplyValue}return i}}function De(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismExpressionMotionManager=Le}(Ee||(Ee={}));let ke,Oe=function(t){return t[t.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",t[t.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",t[t.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",t}({}),Ne=function(t){return t[t.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",t[t.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",t[t.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",t[t.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",t}({});class je{constructor(){De(this,"time",0),De(this,"value",0)}}class ze{constructor(){De(this,"evaluate",void 0),De(this,"basePointIndex",void 0),De(this,"segmentType",void 0),this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class Ue{constructor(){De(this,"type",void 0),De(this,"id",void 0),De(this,"segmentCount",void 0),De(this,"baseSegmentIndex",void 0),De(this,"fadeInTime",void 0),De(this,"fadeOutTime",void 0),this.type=Oe.CubismMotionCurveTarget_Model,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Xe{constructor(){De(this,"fireTime",0),De(this,"value",void 0)}}class Ye{constructor(){De(this,"duration",void 0),De(this,"loop",void 0),De(this,"curveCount",void 0),De(this,"eventCount",void 0),De(this,"fps",void 0),De(this,"curves",void 0),De(this,"segments",void 0),De(this,"points",void 0),De(this,"events",void 0),this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new l,this.segments=new l,this.points=new l,this.events=new l}}!function(t){t.CubismMotionCurve=Ue,t.CubismMotionCurveTarget=Oe,t.CubismMotionData=Ye,t.CubismMotionEvent=Xe,t.CubismMotionPoint=je,t.CubismMotionSegment=ze,t.CubismMotionSegmentType=Ne}(ke||(ke={}));const Ge="Meta",He="Curves",qe="FadeInTime",We="FadeOutTime",$e="Segments",Je="UserData";class Ze{constructor(t,e){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"_json",void 0),this._json=q.create(t,e)}release(){q.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(Ge).getValueByString("Duration").toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(Ge).getValueByString("Loop").toBoolean()}getEvaluationOptionFlag(t){return Qe.EvaluationOptionFlag_AreBeziersRistricted==t&&this._json.getRoot().getValueByString(Ge).getValueByString("AreBeziersRestricted").toBoolean()}getMotionCurveCount(){return this._json.getRoot().getValueByString(Ge).getValueByString("CurveCount").toInt()}getMotionFps(){return this._json.getRoot().getValueByString(Ge).getValueByString("Fps").toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(Ge).getValueByString("TotalSegmentCount").toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(Ge).getValueByString("TotalPointCount").toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(Ge).getValueByString(qe).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(Ge).getValueByString(We).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(Ge).getValueByString(qe).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(Ge).getValueByString(We).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString("Target").getRawString()}getMotionCurveId(t){return ht.getIdManager().getId(this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString("Id").getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString(qe).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString(We).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString(qe).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString(We).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString($e).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(He).getValueByIndex(t).getValueByString($e).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(Ge).getValueByString("UserDataCount").toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(Ge).getValueByString("TotalUserDataSize").toInt()}getEventTime(t){return this._json.getRoot().getValueByString(Je).getValueByIndex(t).getValueByString("Time").toFloat()}getEventValue(t){return new g(this._json.getRoot().getValueByString(Je).getValueByIndex(t).getValueByString("Value").getRawString())}}let Ke,Qe=function(t){return t[t.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",t}({});function ti(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismMotionJson=Ze}(Ke||(Ke={}));const ei="Opacity";function ii(t,e,i){const r=new je;return r.time=t.time+(e.time-t.time)*i,r.value=t.value+(e.value-t.value)*i,r}function ri(t,e){let i=(e-t[0].time)/(t[1].time-t[0].time);return i<0&&(i=0),t[0].value+(t[1].value-t[0].value)*i}function si(t,e){let i=(e-t[0].time)/(t[3].time-t[0].time);i<0&&(i=0);const r=ii(t[0],t[1],i),s=ii(t[1],t[2],i),a=ii(t[2],t[3],i),n=ii(r,s,i),o=ii(s,a,i);return ii(n,o,i).value}function ai(t,e){const i=e,r=t[0].time,s=t[3].time,a=t[1].time,n=t[2].time,o=s-3*n+3*a-r,l=3*n-6*a+3*r,u=3*a-3*r,h=r-i,d=oe.cardanoAlgorithmForBezier(o,l,u,h),g=ii(t[0],t[1],d),c=ii(t[1],t[2],d),_=ii(t[2],t[3],d),m=ii(g,c,d),p=ii(c,_,d);return ii(m,p,d).value}function ni(t,e){return t[0].value}function oi(t,e){return t[1].value}function li(t,e,i){const r=t.curves.at(e);let s=-1;const a=r.baseSegmentIndex+r.segmentCount;let n=0;for(let e=r.baseSegmentIndex;e<a;++e)if(n=t.segments.at(e).basePointIndex+(t.segments.at(e).segmentType==Ne.CubismMotionSegmentType_Bezier?3:1),t.points.at(n).time>i){s=e;break}if(-1==s)return t.points.at(n).value;const o=t.segments.at(s);return o.evaluate(t.points.get(o.basePointIndex),i)}class ui extends fe{static create(t,e,i){const r=new ui;return r.parse(t,e),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=i,r}doUpdateParameters(t,e,i,r){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink=ht.getIdManager().getId("EyeBlink")),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync=ht.getIdManager().getId("LipSync")),null==this._modelCurveIdOpacity&&(this._modelCurveIdOpacity=ht.getIdManager().getId(ei));let s=e-r.getStartTime();s<0&&(s=0);let a=Number.MAX_VALUE,n=Number.MAX_VALUE;const o=64;let l=0,u=0;this._eyeBlinkParameterIds.getSize()>o&&E("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>o&&E("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const h=this._fadeInSeconds<=0?1:oe.getEasingSine((e-r.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||r.getEndTime()<0?1:oe.getEasingSine((r.getEndTime()-e)/this._fadeOutSeconds);let g,c,_,m=s;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const p=this._motionData.curves;for(c=0;c<this._motionData.curveCount&&p.at(c).type==Oe.CubismMotionCurveTarget_Model;++c)g=li(this._motionData,c,m),p.at(c).id==this._modelCurveIdEyeBlink?n=g:p.at(c).id==this._modelCurveIdLipSync?a=g:p.at(c).id==this._modelCurveIdOpacity&&(this._modelOpacity=g,t.setModelOapcity(this.getModelOpacityValue()));for(;c<this._motionData.curveCount&&p.at(c).type==Oe.CubismMotionCurveTarget_Parameter;++c){if(_=t.getParameterIndex(p.at(c).id),-1==_)continue;const s=t.getParameterValueByIndex(_);if(g=li(this._motionData,c,m),n!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.getSize()&&t<o;++t)if(this._eyeBlinkParameterIds.at(t)==p.at(c).id){g*=n,u|=1<<t;break}if(a!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.getSize()&&t<o;++t)if(this._lipSyncParameterIds.at(t)==p.at(c).id){g+=a,l|=1<<t;break}let f;if(p.at(c).fadeInTime<0&&p.at(c).fadeOutTime<0)f=s+(g-s)*i;else{let t,i;t=p.at(c).fadeInTime<0?h:0==p.at(c).fadeInTime?1:oe.getEasingSine((e-r.getFadeInStartTime())/p.at(c).fadeInTime),i=p.at(c).fadeOutTime<0?d:0==p.at(c).fadeOutTime||r.getEndTime()<0?1:oe.getEasingSine((r.getEndTime()-e)/p.at(c).fadeOutTime),f=s+(g-s)*(this._weight*t*i)}t.setParameterValueByIndex(_,f,1)}if(n!=Number.MAX_VALUE)for(let e=0;e<this._eyeBlinkParameterIds.getSize()&&e<o;++e){const r=t.getParameterValueById(this._eyeBlinkParameterIds.at(e));if(u>>e&1)continue;const s=r+(n-r)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(e),s)}if(a!=Number.MAX_VALUE)for(let e=0;e<this._lipSyncParameterIds.getSize()&&e<o;++e){const r=t.getParameterValueById(this._lipSyncParameterIds.at(e));if(l>>e&1)continue;const s=r+(a-r)*i;t.setParameterValueById(this._lipSyncParameterIds.at(e),s)}for(;c<this._motionData.curveCount&&p.at(c).type==Oe.CubismMotionCurveTarget_PartOpacity;++c)_=t.getParameterIndex(p.at(c).id),-1!=_&&(g=li(this._motionData,c,m),t.setParameterValueByIndex(_,g));s>=this._motionData.duration&&(this._isLoop?(r.setStartTime(e),this._isLoopFadeIn&&r.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id)return void(i.at(r).fadeInTime=e)}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id)return void(i.at(r).fadeOutTime=e)}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}constructor(){super(),ti(this,"_sourceFrameRate",void 0),ti(this,"_loopDurationSeconds",void 0),ti(this,"_isLoop",void 0),ti(this,"_isLoopFadeIn",void 0),ti(this,"_lastWeight",void 0),ti(this,"_motionData",void 0),ti(this,"_eyeBlinkParameterIds",void 0),ti(this,"_lipSyncParameterIds",void 0),ti(this,"_modelCurveIdEyeBlink",void 0),ti(this,"_modelCurveIdLipSync",void 0),ti(this,"_modelCurveIdOpacity",void 0),ti(this,"_modelOpacity",void 0),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new Ye;let i=new Ze(t,e);if(!i)return i.release(),void(i=void 0);this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();const r=i.getEvaluationOptionFlag(Qe.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,Ue,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),ze,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),je,!0),this._motionData.events.updateSize(this._motionData.eventCount,Xe,!0);let s=0,a=0;for(let t=0;t<this._motionData.curveCount;++t){"Model"==i.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=Oe.CubismMotionCurveTarget_Model:"Parameter"==i.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=Oe.CubismMotionCurveTarget_Parameter:"PartOpacity"==i.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=Oe.CubismMotionCurveTarget_PartOpacity:A('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(t).id=i.getMotionCurveId(t),this._motionData.curves.at(t).baseSegmentIndex=a,this._motionData.curves.at(t).fadeInTime=i.isExistMotionCurveFadeInTime(t)?i.getMotionCurveFadeInTime(t):-1,this._motionData.curves.at(t).fadeOutTime=i.isExistMotionCurveFadeOutTime(t)?i.getMotionCurveFadeOutTime(t):-1;for(let e=0;e<i.getMotionCurveSegmentCount(t);){switch(0==e?(this._motionData.segments.at(a).basePointIndex=s,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+1),s+=1,e+=2):this._motionData.segments.at(a).basePointIndex=s-1,i.getMotionCurveSegment(t,e)){case Ne.CubismMotionSegmentType_Linear:this._motionData.segments.at(a).segmentType=Ne.CubismMotionSegmentType_Linear,this._motionData.segments.at(a).evaluate=ri,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),s+=1,e+=3;break;case Ne.CubismMotionSegmentType_Bezier:this._motionData.segments.at(a).segmentType=Ne.CubismMotionSegmentType_Bezier,this._motionData.segments.at(a).evaluate=r?si:ai,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),this._motionData.points.at(s+1).time=i.getMotionCurveSegment(t,e+3),this._motionData.points.at(s+1).value=i.getMotionCurveSegment(t,e+4),this._motionData.points.at(s+2).time=i.getMotionCurveSegment(t,e+5),this._motionData.points.at(s+2).value=i.getMotionCurveSegment(t,e+6),s+=3,e+=7;break;case Ne.CubismMotionSegmentType_Stepped:this._motionData.segments.at(a).segmentType=Ne.CubismMotionSegmentType_Stepped,this._motionData.segments.at(a).evaluate=ni,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),s+=1,e+=3;break;case Ne.CubismMotionSegmentType_InverseStepped:this._motionData.segments.at(a).segmentType=Ne.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(a).evaluate=oi,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),s+=1,e+=3;break;default:V(0)}++this._motionData.curves.at(t).segmentCount,++a}}for(let t=0;t<i.getEventCount();++t)this._motionData.events.at(t).fireTime=i.getEventTime(t),this._motionData.events.at(t).value=i.getEventValue(t);i.release(),i=void 0,i=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new g(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==Oe.CubismMotionCurveTarget_Model&&0==e.id.getString().s.localeCompare(ei))return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==Oe.CubismMotionCurveTarget_Model&&0==e.id.getString().s.localeCompare(ei))return t}return-1}getModelOpacityId(t){if(-1!=t){const e=this._motionData.curves.at(t);if(e.type==Oe.CubismMotionCurveTarget_Model&&0==e.id.getString().s.localeCompare(ei))return ht.getIdManager().getId(e.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}}let hi,di;function gi(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismMotion=ui}(hi||(hi={}));class ci extends Te{constructor(){super(),gi(this,"_currentPriority",void 0),gi(this,"_reservePriority",void 0),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return!(t<=this._reservePriority||t<=this._currentPriority||(this._reservePriority=t,0))}}function _i(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismMotionManager=ci}(di||(di={}));let mi,pi=function(t){return t[t.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",t}({}),fi=function(t){return t[t.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",t[t.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",t[t.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",t}({});class vi{constructor(){_i(this,"gravity",void 0),_i(this,"wind",void 0),this.gravity=new ne(0,0),this.wind=new ne(0,0)}}class yi{constructor(){_i(this,"id",void 0),_i(this,"targetType",void 0)}}class Si{constructor(){_i(this,"minimum",void 0),_i(this,"maximum",void 0),_i(this,"defalut",void 0)}}class bi{constructor(){_i(this,"initialPosition",void 0),_i(this,"mobility",void 0),_i(this,"delay",void 0),_i(this,"acceleration",void 0),_i(this,"radius",void 0),_i(this,"position",void 0),_i(this,"lastPosition",void 0),_i(this,"lastGravity",void 0),_i(this,"force",void 0),_i(this,"velocity",void 0),this.initialPosition=new ne(0,0),this.position=new ne(0,0),this.lastPosition=new ne(0,0),this.lastGravity=new ne(0,0),this.force=new ne(0,0),this.velocity=new ne(0,0)}}class xi{constructor(){_i(this,"inputCount",void 0),_i(this,"outputCount",void 0),_i(this,"particleCount",void 0),_i(this,"baseInputIndex",void 0),_i(this,"baseOutputIndex",void 0),_i(this,"baseParticleIndex",void 0),_i(this,"normalizationPosition",void 0),_i(this,"normalizationAngle",void 0),this.normalizationPosition=new Si,this.normalizationAngle=new Si}}class Ci{constructor(){_i(this,"source",void 0),_i(this,"sourceParameterIndex",void 0),_i(this,"weight",void 0),_i(this,"type",void 0),_i(this,"reflect",void 0),_i(this,"getNormalizedParameterValue",void 0),this.source=new yi}}class Pi{constructor(){_i(this,"destination",void 0),_i(this,"destinationParameterIndex",void 0),_i(this,"vertexIndex",void 0),_i(this,"translationScale",void 0),_i(this,"angleScale",void 0),_i(this,"weight",void 0),_i(this,"type",void 0),_i(this,"reflect",void 0),_i(this,"valueBelowMinimum",void 0),_i(this,"valueExceededMaximum",void 0),_i(this,"getValue",void 0),_i(this,"getScale",void 0),this.destination=new yi,this.translationScale=new ne(0,0)}}class Mi{constructor(){_i(this,"subRigCount",void 0),_i(this,"settings",void 0),_i(this,"inputs",void 0),_i(this,"outputs",void 0),_i(this,"particles",void 0),_i(this,"gravity",void 0),_i(this,"wind",void 0),_i(this,"fps",void 0),this.settings=new l,this.inputs=new l,this.outputs=new l,this.particles=new l,this.gravity=new ne(0,0),this.wind=new ne(0,0),this.fps=0}}!function(t){t.CubismPhysicsInput=Ci,t.CubismPhysicsNormalization=Si,t.CubismPhysicsOutput=Pi,t.CubismPhysicsParameter=yi,t.CubismPhysicsParticle=bi,t.CubismPhysicsRig=Mi,t.CubismPhysicsSource=fi,t.CubismPhysicsSubRig=xi,t.CubismPhysicsTargetType=pi,t.PhysicsJsonEffectiveForces=vi}(mi||(mi={}));const wi="Position",Bi="Angle",Ii="Type",Ti="Meta",Vi="EffectiveForces",Fi="Gravity",Ei="Wind",Ri="PhysicsSettings",Ai="Normalization",Li="Minimum",Di="Maximum",ki="Default",Oi="Reflect",Ni="Weight",ji="Input",zi="Output",Ui="Vertices";class Xi{constructor(t,e){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"_json",void 0),this._json=q.create(t,e)}release(){q.delete(this._json)}getGravity(){const t=new ne(0,0);return t.x=this._json.getRoot().getValueByString(Ti).getValueByString(Vi).getValueByString(Fi).getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(Ti).getValueByString(Vi).getValueByString(Fi).getValueByString("Y").toFloat(),t}getWind(){const t=new ne(0,0);return t.x=this._json.getRoot().getValueByString(Ti).getValueByString(Vi).getValueByString(Ei).getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(Ti).getValueByString(Vi).getValueByString(Ei).getValueByString("Y").toFloat(),t}getFps(){return this._json.getRoot().getValueByString(Ti).getValueByString("Fps").toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(Ti).getValueByString("PhysicsSettingCount").toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(Ti).getValueByString("TotalInputCount").toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(Ti).getValueByString("TotalOutputCount").toInt()}getVertexCount(){return this._json.getRoot().getValueByString(Ti).getValueByString("VertexCount").toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ai).getValueByString(wi).getValueByString(Li).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ai).getValueByString(wi).getValueByString(Di).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ai).getValueByString(wi).getValueByString(ki).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ai).getValueByString(Bi).getValueByString(Li).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ai).getValueByString(Bi).getValueByString(Di).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ai).getValueByString(Bi).getValueByString(ki).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(ji).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(ji).getValueByIndex(e).getValueByString(Ni).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(ji).getValueByIndex(e).getValueByString(Oi).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(ji).getValueByIndex(e).getValueByString(Ii).getRawString()}getInputSourceId(t,e){return ht.getIdManager().getId(this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(ji).getValueByIndex(e).getValueByString("Source").getValueByString("Id").getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(zi).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(zi).getValueByIndex(e).getValueByString("VertexIndex").toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(zi).getValueByIndex(e).getValueByString("Scale").toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(zi).getValueByIndex(e).getValueByString(Ni).toFloat()}getOutputDestinationId(t,e){return ht.getIdManager().getId(this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(zi).getValueByIndex(e).getValueByString("Destination").getValueByString("Id").getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(zi).getValueByIndex(e).getValueByString(Ii).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(zi).getValueByIndex(e).getValueByString(Oi).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ui).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ui).getValueByIndex(e).getValueByString("Mobility").toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ui).getValueByIndex(e).getValueByString("Delay").toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ui).getValueByIndex(e).getValueByString("Acceleration").toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ui).getValueByIndex(e).getValueByString("Radius").toFloat()}getParticlePosition(t,e){const i=new ne(0,0);return i.x=this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ui).getValueByIndex(e).getValueByString(wi).getValueByString("X").toFloat(),i.y=this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(Ui).getValueByIndex(e).getValueByString(wi).getValueByString("Y").toFloat(),i}}let Yi;function Gi(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismPhysicsJson=Xi}(Yi||(Yi={}));const Hi="Angle";class qi{static create(t,e){const i=new qi;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){null!=t&&(t.release(),t=null)}parse(t,e){this._physicsRig=new Mi;let i=new Xi(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,xi,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),Ci,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),Pi,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),bi,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,s=0,a=0;for(let t=0;t<this._physicsRig.settings.getSize();++t){this._physicsRig.settings.at(t).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(t),this._physicsRig.settings.at(t).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(t),this._physicsRig.settings.at(t).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(t),this._physicsRig.settings.at(t).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(t),this._physicsRig.settings.at(t).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(t),this._physicsRig.settings.at(t).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(t),this._physicsRig.settings.at(t).inputCount=i.getInputCount(t),this._physicsRig.settings.at(t).baseInputIndex=r;for(let e=0;e<this._physicsRig.settings.at(t).inputCount;++e)this._physicsRig.inputs.at(r+e).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+e).weight=i.getInputWeight(t,e),this._physicsRig.inputs.at(r+e).reflect=i.getInputReflect(t,e),"X"==i.getInputType(t,e)?(this._physicsRig.inputs.at(r+e).type=fi.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=Ji):"Y"==i.getInputType(t,e)?(this._physicsRig.inputs.at(r+e).type=fi.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=Zi):i.getInputType(t,e)==Hi&&(this._physicsRig.inputs.at(r+e).type=fi.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=Ki),this._physicsRig.inputs.at(r+e).source.targetType=pi.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+e).source.id=i.getInputSourceId(t,e);r+=this._physicsRig.settings.at(t).inputCount,this._physicsRig.settings.at(t).outputCount=i.getOutputCount(t),this._physicsRig.settings.at(t).baseOutputIndex=s;const e=new $i;e.outputs.resize(this._physicsRig.settings.at(t).outputCount);const n=new $i;n.outputs.resize(this._physicsRig.settings.at(t).outputCount);for(let r=0;r<this._physicsRig.settings.at(t).outputCount;++r)e.outputs.set(r,0),n.outputs.set(r,0),this._physicsRig.outputs.at(s+r).destinationParameterIndex=-1,this._physicsRig.outputs.at(s+r).vertexIndex=i.getOutputVertexIndex(t,r),this._physicsRig.outputs.at(s+r).angleScale=i.getOutputAngleScale(t,r),this._physicsRig.outputs.at(s+r).weight=i.getOutputWeight(t,r),this._physicsRig.outputs.at(s+r).destination.targetType=pi.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(s+r).destination.id=i.getOutputDestinationId(t,r),"X"==i.getOutputType(t,r)?(this._physicsRig.outputs.at(s+r).type=fi.CubismPhysicsSource_X,this._physicsRig.outputs.at(s+r).getValue=Qi,this._physicsRig.outputs.at(s+r).getScale=ir):"Y"==i.getOutputType(t,r)?(this._physicsRig.outputs.at(s+r).type=fi.CubismPhysicsSource_Y,this._physicsRig.outputs.at(s+r).getValue=tr,this._physicsRig.outputs.at(s+r).getScale=rr):i.getOutputType(t,r)==Hi&&(this._physicsRig.outputs.at(s+r).type=fi.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(s+r).getValue=er,this._physicsRig.outputs.at(s+r).getScale=sr),this._physicsRig.outputs.at(s+r).reflect=i.getOutputReflect(t,r);this._currentRigOutputs.pushBack(e),this._previousRigOutputs.pushBack(n),s+=this._physicsRig.settings.at(t).outputCount,this._physicsRig.settings.at(t).particleCount=i.getParticleCount(t),this._physicsRig.settings.at(t).baseParticleIndex=a;for(let e=0;e<this._physicsRig.settings.at(t).particleCount;++e)this._physicsRig.particles.at(a+e).mobility=i.getParticleMobility(t,e),this._physicsRig.particles.at(a+e).delay=i.getParticleDelay(t,e),this._physicsRig.particles.at(a+e).acceleration=i.getParticleAcceleration(t,e),this._physicsRig.particles.at(a+e).radius=i.getParticleRadius(t,e),this._physicsRig.particles.at(a+e).position=i.getParticlePosition(t,e);a+=this._physicsRig.settings.at(t).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var e,i,r,s;let a,n,o,l;const u=new ne;let h,d,g,c;const _=t.getModel().parameters.values,m=t.getModel().parameters.maximumValues,p=t.getModel().parameters.minimumValues,f=t.getModel().parameters.defaultValues;(null!==(e=null===(i=this._parameterCaches)||void 0===i?void 0:i.length)&&void 0!==e?e:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(null!==(r=null===(s=this._parameterInputCaches)||void 0===s?void 0:s.length)&&void 0!==r?r:0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let e=0;e<t.getParameterCount();++e)this._parameterCaches[e]=_[e],this._parameterInputCaches[e]=_[e];for(let e=0;e<this._physicsRig.subRigCount;++e){a={angle:0},u.x=0,u.y=0,h=this._physicsRig.settings.at(e),d=this._physicsRig.inputs.get(h.baseInputIndex),g=this._physicsRig.outputs.get(h.baseOutputIndex),c=this._physicsRig.particles.get(h.baseParticleIndex);for(let e=0;e<h.inputCount;++e)n=d[e].weight/100,-1==d[e].sourceParameterIndex&&(d[e].sourceParameterIndex=t.getParameterIndex(d[e].source.id)),d[e].getNormalizedParameterValue(u,a,_[d[e].sourceParameterIndex],p[d[e].sourceParameterIndex],m[d[e].sourceParameterIndex],f[d[e].sourceParameterIndex],h.normalizationPosition,h.normalizationAngle,d[e].reflect,n),this._parameterCaches[d[e].sourceParameterIndex]=_[d[e].sourceParameterIndex];o=oe.degreesToRadian(-a.angle),u.x=u.x*oe.cos(o)-u.y*oe.sin(o),u.y=u.x*oe.sin(o)+u.y*oe.cos(o),nr(c,h.particleCount,u,a.angle,this._options.wind,.001*h.normalizationPosition.maximum);for(let i=0;i<h.outputCount;++i){const r=g[i].vertexIndex;if(-1==g[i].destinationParameterIndex&&(g[i].destinationParameterIndex=t.getParameterIndex(g[i].destination.id)),r<1||r>=h.particleCount)continue;let s=new ne;s=c[r].position.substract(c[r-1].position),l=g[i].getValue(s,c,r,g[i].reflect,this._options.gravity),this._currentRigOutputs.at(e).outputs.set(i,l),this._previousRigOutputs.at(e).outputs.set(i,l);const a=g[i].destinationParameterIndex,n=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(_.subarray(a))):_.slice(a);or(n,p[a],m[a],l,g[i]);for(let t=a,e=0;t<this._parameterCaches.length;t++,e++)_[t]=this._parameterCaches[t]=n[e]}}}evaluate(t,e){var i,r,s,a;let n,o,l,u;const h=new ne;let d,g,c,_;if(0>=e)return;const m=t.getModel().parameters.values,p=t.getModel().parameters.maximumValues,f=t.getModel().parameters.minimumValues,v=t.getModel().parameters.defaultValues;let y;if(this._currentRemainTime+=e,this._currentRemainTime>5&&(this._currentRemainTime=0),(null!==(i=null===(r=this._parameterCaches)||void 0===r?void 0:r.length)&&void 0!==i?i:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(null!==(s=null===(a=this._parameterInputCaches)||void 0===a?void 0:a.length)&&void 0!==s?s:0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let e=0;e<t.getParameterCount();++e)this._parameterInputCaches[e]=m[e]}for(y=this._physicsRig.fps>0?1/this._physicsRig.fps:e;this._currentRemainTime>=y;){for(let t=0;t<this._physicsRig.subRigCount;++t){d=this._physicsRig.settings.at(t),c=this._physicsRig.outputs.get(d.baseOutputIndex);for(let e=0;e<d.outputCount;++e)this._previousRigOutputs.at(t).outputs.set(e,this._currentRigOutputs.at(t).outputs.at(e))}const e=y/this._currentRemainTime;for(let i=0;i<t.getParameterCount();++i)this._parameterCaches[i]=this._parameterInputCaches[i]*(1-e)+m[i]*e,this._parameterInputCaches[i]=this._parameterCaches[i];for(let e=0;e<this._physicsRig.subRigCount;++e){n={angle:0},h.x=0,h.y=0,d=this._physicsRig.settings.at(e),g=this._physicsRig.inputs.get(d.baseInputIndex),c=this._physicsRig.outputs.get(d.baseOutputIndex),_=this._physicsRig.particles.get(d.baseParticleIndex);for(let e=0;e<d.inputCount;++e)o=g[e].weight/100,-1==g[e].sourceParameterIndex&&(g[e].sourceParameterIndex=t.getParameterIndex(g[e].source.id)),g[e].getNormalizedParameterValue(h,n,this._parameterCaches[g[e].sourceParameterIndex],f[g[e].sourceParameterIndex],p[g[e].sourceParameterIndex],v[g[e].sourceParameterIndex],d.normalizationPosition,d.normalizationAngle,g[e].reflect,o);l=oe.degreesToRadian(-n.angle),h.x=h.x*oe.cos(l)-h.y*oe.sin(l),h.y=h.x*oe.sin(l)+h.y*oe.cos(l),ar(_,d.particleCount,h,n.angle,this._options.wind,.001*d.normalizationPosition.maximum,y,5);for(let i=0;i<d.outputCount;++i){const r=c[i].vertexIndex;if(-1==c[i].destinationParameterIndex&&(c[i].destinationParameterIndex=t.getParameterIndex(c[i].destination.id)),r<1||r>=d.particleCount)continue;const s=new ne;s.x=_[r].position.x-_[r-1].position.x,s.y=_[r].position.y-_[r-1].position.y,u=c[i].getValue(s,_,r,c[i].reflect,this._options.gravity),this._currentRigOutputs.at(e).outputs.set(i,u);const a=c[i].destinationParameterIndex,n=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(a))):this._parameterCaches.slice(a);or(n,f[a],p[a],u,c[i]);for(let t=a,e=0;t<this._parameterCaches.length;t++,e++)this._parameterCaches[t]=n[e]}}this._currentRemainTime-=y}const S=this._currentRemainTime/y;this.interpolate(t,S)}interpolate(t,e){let i,r;const s=t.getModel().parameters.values,a=t.getModel().parameters.maximumValues,n=t.getModel().parameters.minimumValues;for(let t=0;t<this._physicsRig.subRigCount;++t){r=this._physicsRig.settings.at(t),i=this._physicsRig.outputs.get(r.baseOutputIndex);for(let o=0;o<r.outputCount;++o){if(-1==i[o].destinationParameterIndex)continue;const r=i[o].destinationParameterIndex,l=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(s.subarray(r))):s.slice(r);or(l,n[r],a[r],this._previousRigOutputs.at(t).outputs.at(o)*(1-e)+this._currentRigOutputs.at(t).outputs.at(o)*e,i[o]);for(let t=r,e=0;t<s.length;t++,e++)s[t]=l[e]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){Gi(this,"_physicsRig",void 0),Gi(this,"_options",void 0),Gi(this,"_currentRigOutputs",void 0),Gi(this,"_previousRigOutputs",void 0),Gi(this,"_currentRemainTime",void 0),Gi(this,"_parameterCaches",void 0),Gi(this,"_parameterInputCaches",void 0),this._physicsRig=null,this._options=new Wi,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new l,this._previousRigOutputs=new l,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings.at(r),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new ne(0,0),t[0].lastPosition=new ne(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new ne(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new ne(0,0),t[0].force=new ne(0,0);for(let r=1;r<e.particleCount;++r)i=new ne(0,0),i.y=t[r].radius,t[r].initialPosition=new ne(t[r-1].initialPosition.x+i.x,t[r-1].initialPosition.y+i.y),t[r].position=new ne(t[r].initialPosition.x,t[r].initialPosition.y),t[r].lastPosition=new ne(t[r].initialPosition.x,t[r].initialPosition.y),t[r].lastGravity=new ne(0,-1),t[r].lastGravity.y*=-1,t[r].velocity=new ne(0,0),t[r].force=new ne(0,0)}}}class Wi{constructor(){Gi(this,"gravity",void 0),Gi(this,"wind",void 0),this.gravity=new ne(0,0),this.wind=new ne(0,0)}}class $i{constructor(){Gi(this,"outputs",void 0),this.outputs=new l(0)}}function Ji(t,e,i,r,s,a,n,o,l,u){t.x+=lr(i,r,s,0,n.minimum,n.maximum,n.defalut,l)*u}function Zi(t,e,i,r,s,a,n,o,l,u){t.y+=lr(i,r,s,0,n.minimum,n.maximum,n.defalut,l)*u}function Ki(t,e,i,r,s,a,n,o,l,u){e.angle+=lr(i,r,s,0,o.minimum,o.maximum,o.defalut,l)*u}function Qi(t,e,i,r,s){let a=t.x;return r&&(a*=-1),a}function tr(t,e,i,r,s){let a=t.y;return r&&(a*=-1),a}function er(t,e,i,r,s){let a;return s=i>=2?e[i-1].position.substract(e[i-2].position):s.multiplyByScaler(-1),a=oe.directionToRadian(s,t),r&&(a*=-1),a}function ir(t,e){return JSON.parse(JSON.stringify(t.x))}function rr(t,e){return JSON.parse(JSON.stringify(t.y))}function sr(t,e){return JSON.parse(JSON.stringify(e))}function ar(t,e,i,r,s,a,n,o){let l,u,h=new ne(0,0),d=new ne(0,0),g=new ne(0,0),c=new ne(0,0);t[0].position=new ne(i.x,i.y);const _=oe.degreesToRadian(r),m=oe.radianToDirection(_);m.normalize();for(let i=1;i<e;++i)t[i].force=m.multiplyByScaler(t[i].acceleration).add(s),t[i].lastPosition=new ne(t[i].position.x,t[i].position.y),l=t[i].delay*n*30,h=t[i].position.substract(t[i-1].position),u=oe.directionToRadian(t[i].lastGravity,m)/o,h.x=oe.cos(u)*h.x-h.y*oe.sin(u),h.y=oe.sin(u)*h.x+h.y*oe.cos(u),t[i].position=t[i-1].position.add(h),d=t[i].velocity.multiplyByScaler(l),g=t[i].force.multiplyByScaler(l).multiplyByScaler(l),t[i].position=t[i].position.add(d).add(g),c=t[i].position.substract(t[i-1].position),c.normalize(),t[i].position=t[i-1].position.add(c.multiplyByScaler(t[i].radius)),oe.abs(t[i].position.x)<a&&(t[i].position.x=0),0!=l&&(t[i].velocity=t[i].position.substract(t[i].lastPosition),t[i].velocity=t[i].velocity.divisionByScalar(l),t[i].velocity=t[i].velocity.multiplyByScaler(t[i].mobility)),t[i].force=new ne(0,0),t[i].lastGravity=new ne(m.x,m.y)}function nr(t,e,i,r,s,a){let n=new ne(0,0);t[0].position=new ne(i.x,i.y);const o=oe.degreesToRadian(r),l=oe.radianToDirection(o);l.normalize();for(let i=1;i<e;++i)t[i].force=l.multiplyByScaler(t[i].acceleration).add(s),t[i].lastPosition=new ne(t[i].position.x,t[i].position.y),t[i].velocity=new ne(0,0),n=t[i].force,n.normalize(),n=n.multiplyByScaler(t[i].radius),t[i].position=t[i-1].position.add(n),oe.abs(t[i].position.x)<a&&(t[i].position.x=0),t[i].force=new ne(0,0),t[i].lastGravity=new ne(l.x,l.y)}function or(t,e,i,r,s){let a;a=r*s.getScale(s.translationScale,s.angleScale),a<e?(a<s.valueBelowMinimum&&(s.valueBelowMinimum=a),a=e):a>i&&(a>s.valueExceededMaximum&&(s.valueExceededMaximum=a),a=i);const n=s.weight/100;n>=1||(a=t[0]*(1-n)+a*n),t[0]=a}function lr(t,e,i,r,s,a,n,o){let l=0;const u=oe.max(i,e);u<t&&(t=u);const h=oe.min(i,e);h>t&&(t=h);const d=oe.min(s,a),g=oe.max(s,a),c=n,_=(p=h,f=u,oe.min(p,f)+function(t,e){const i=oe.max(t,e),r=oe.min(t,e);return oe.abs(i-r)}(p,f)/2),m=t-_;var p,f;switch(function(t){let e=0;return t>0?e=1:t<0&&(e=-1),e}(m)){case 1:{const t=u-_;0!=t&&(l=m*((g-c)/t),l+=c);break}case-1:{const t=h-_;0!=t&&(l=m*((d-c)/t),l+=c);break}case 0:l=c}return o?l:-1*l}let ur,hr;function dr(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismPhysics=qi,t.Options=Wi}(ur||(ur={}));class gr{constructor(t){dr(this,"_clearedFrameBufferFlags",void 0),dr(this,"_channelColors",void 0),dr(this,"_clippingContextListForMask",void 0),dr(this,"_clippingContextListForDraw",void 0),dr(this,"_clippingMaskBufferSize",void 0),dr(this,"_renderTextureCount",void 0),dr(this,"_tmpMatrix",void 0),dr(this,"_tmpMatrixForMask",void 0),dr(this,"_tmpMatrixForDraw",void 0),dr(this,"_tmpBoundsOnModel",void 0),dr(this,"_clippingContexttConstructor",void 0),this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new l,this._clippingContextListForDraw=new l,this._channelColors=new l,this._tmpBoundsOnModel=new x,this._tmpMatrix=new S,this._tmpMatrixForMask=new S,this._tmpMatrixForDraw=new S,this._clippingContexttConstructor=t;let e=new B;e.r=1,e.g=0,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new B,e.r=0,e.g=1,e.b=0,e.a=0,this._channelColors.pushBack(e),e=new B,e.r=0,e.g=0,e.b=1,e.a=0,this._channelColors.pushBack(e),e=new B,e.r=0,e.g=0,e.b=0,e.a=1,this._channelColors.pushBack(e)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null;for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,null!=this._clearedFrameBufferFlags&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(t,e){e%1!=0&&(A("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),e=~~e),e<1&&A("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=e<1?1:e,this._clearedFrameBufferFlags=new l(this._renderTextureCount);for(let e=0;e<t.getDrawableCount();e++){if(t.getDrawableMaskCounts()[e]<=0){this._clippingContextListForDraw.pushBack(null);continue}let i=this.findSameClip(t.getDrawableMasks()[e],t.getDrawableMaskCounts()[e]);null==i&&(i=new this._clippingContexttConstructor(this,t.getDrawableMasks()[e],t.getDrawableMaskCounts()[e]),this._clippingContextListForMask.pushBack(i)),i.addClippedDrawable(e),this._clippingContextListForDraw.pushBack(i)}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),s=r._clippingIdCount;if(s!=e)continue;let a=0;for(let e=0;e<s;e++){const i=r._clippingIdList[e];for(let e=0;e<s;e++)if(t[e]==i){a++;break}}if(a==s)return r}return null}setupMatrixForHighPrecision(t,e){let i=0;for(let e=0;e<this._clippingContextListForMask.getSize();e++){const r=this._clippingContextListForMask.at(e);this.calcClippedDrawTotalBounds(t,r),r._isUsing&&i++}if(i>0){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let t=0;t<this._renderTextureCount;t++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let t=0;t<this._renderTextureCount;t++)this._clearedFrameBufferFlags.set(t,!1);for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),s=r._allClippedDrawRect,a=r._layoutBounds,n=.05;let o=0,l=0;const u=t.getPixelsPerUnit(),h=r.getClippingManager().getClippingMaskBufferSize(),d=a.width*h,g=a.height*h;this._tmpBoundsOnModel.setRect(s),this._tmpBoundsOnModel.width*u>d?(this._tmpBoundsOnModel.expand(s.width*n,0),o=a.width/this._tmpBoundsOnModel.width):o=u/d,this._tmpBoundsOnModel.height*u>g?(this._tmpBoundsOnModel.expand(0,s.height*n),l=a.height/this._tmpBoundsOnModel.height):l=u/g,this.createMatrixForMask(e,a,o,l),r._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),r._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(t,e,i,r){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(e.x,e.y),this._tmpMatrix.scaleRelative(i,r),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(e.x,e.y*(t?-1:1)),this._tmpMatrix.scaleRelative(i,r*(t?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(t){const e=this._renderTextureCount<=1?36:32*this._renderTextureCount;if(t<=0||t>e){t>e&&L("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",t-e,this._renderTextureCount,t);for(let t=0;t<this._clippingContextListForMask.getSize();t++){const e=this._clippingContextListForMask.at(t);e._layoutChannelIndex=0,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let r=t/this._renderTextureCount;const s=t%this._renderTextureCount;r=Math.ceil(r);let a=r/4;const n=r%4;a=~~a;let o=0;for(let r=0;r<this._renderTextureCount;r++)for(let l=0;l<4;l++){let u=a+(l<n?1:0);if(l==n+(a<1?-1:0)&&s>0&&(u-=r<s?0:1),0==u);else if(1==u){const t=this._clippingContextListForMask.at(o++);t._layoutChannelIndex=l,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1,t._bufferIndex=r}else if(2==u)for(let t=0;t<u;t++){let e=t%2;e=~~e;const i=this._clippingContextListForMask.at(o++);i._layoutChannelIndex=l,i._layoutBounds.x=.5*e,i._layoutBounds.y=0,i._layoutBounds.width=.5,i._layoutBounds.height=1,i._bufferIndex=r}else if(u<=4)for(let t=0;t<u;t++){let e=t%2,i=t/2;e=~~e,i=~~i;const s=this._clippingContextListForMask.at(o++);s._layoutChannelIndex=l,s._layoutBounds.x=.5*e,s._layoutBounds.y=.5*i,s._layoutBounds.width=.5,s._layoutBounds.height=.5,s._bufferIndex=r}else if(u<=i)for(let t=0;t<u;t++){let e=t%3,i=t/3;e=~~e,i=~~i;const s=this._clippingContextListForMask.at(o++);s._layoutChannelIndex=l,s._layoutBounds.x=e/3,s._layoutBounds.y=i/3,s._layoutBounds.width=1/3,s._layoutBounds.height=1/3,s._bufferIndex=r}else{L("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",t-e,this._renderTextureCount,t);for(let t=0;t<u;t++){const t=this._clippingContextListForMask.at(o++);t._layoutChannelIndex=0,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1,t._bufferIndex=0}}}}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,r=Number.MAX_VALUE,s=Number.MIN_VALUE,a=Number.MIN_VALUE;const n=e._clippedDrawableIndexList.length;for(let o=0;o<n;o++){const n=e._clippedDrawableIndexList[o],l=t.getDrawableVertexCount(n),u=t.getDrawableVertices(n);let h=Number.MAX_VALUE,d=Number.MAX_VALUE,g=-Number.MAX_VALUE,c=-Number.MAX_VALUE;const _=l*lt.vertexStep;for(let t=lt.vertexOffset;t<_;t+=lt.vertexStep){const e=u[t],i=u[t+1];e<h&&(h=e),e>g&&(g=e),i<d&&(d=i),i>c&&(c=i)}if(h!=Number.MAX_VALUE)if(h<i&&(i=h),d<r&&(r=d),g>s&&(s=g),c>a&&(a=c),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const t=s-i,n=a-r;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=r,e._allClippedDrawRect.width=t,e._allClippedDrawRect.height=n}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(t){return this._channelColors.at(t)}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}}function cr(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class _r{static getInstance(){return null==hr?(hr=new _r,hr):hr}static deleteInstance(){hr&&(hr.release(),hr=null)}constructor(){cr(this,"_shaderSets",void 0),cr(this,"gl",void 0),this._shaderSets=new l}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(t,e,i){let r,s,a,n;t.isPremultipliedAlpha()||L("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders();const o=null!=t.getClippingContextBufferForDraw(),l=e.getDrawableInvertedMaskBit(i),u=o?l?2:1:0;let h;switch(e.getDrawableBlendMode(i)){case w.CubismBlendMode_Normal:default:h=this._shaderSets.at(pr.ShaderNames_NormalPremultipliedAlpha+u),r=this.gl.ONE,s=this.gl.ONE_MINUS_SRC_ALPHA,a=this.gl.ONE,n=this.gl.ONE_MINUS_SRC_ALPHA;break;case w.CubismBlendMode_Additive:h=this._shaderSets.at(pr.ShaderNames_AddPremultipliedAlpha+u),r=this.gl.ONE,s=this.gl.ONE,a=this.gl.ZERO,n=this.gl.ONE;break;case w.CubismBlendMode_Multiplicative:h=this._shaderSets.at(pr.ShaderNames_MultPremultipliedAlpha+u),r=this.gl.DST_COLOR,s=this.gl.ONE_MINUS_SRC_ALPHA,a=this.gl.ZERO,n=this.gl.ONE}this.gl.useProgram(h.shaderProgram),null==t._bufferData.vertex&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const d=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(h.attributePositionLocation),this.gl.vertexAttribPointer(h.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==t._bufferData.uv&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const g=e.getDrawableVertexUvs(i);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,g,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(h.attributeTexCoordLocation),this.gl.vertexAttribPointer(h.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),o){this.gl.activeTexture(this.gl.TEXTURE1);const e=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(h.samplerTexture1Location,1),this.gl.uniformMatrix4fv(h.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const i=t.getClippingContextBufferForDraw()._layoutChannelIndex,r=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(h.uniformChannelFlagLocation,r.r,r.g,r.b,r.a)}const c=e.getDrawableTextureIndex(i),_=t.getBindedTextures().getValue(c);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,_),this.gl.uniform1i(h.samplerTexture0Location,0);const m=t.getMvpMatrix();this.gl.uniformMatrix4fv(h.uniformMatrixLocation,!1,m.getArray());const p=t.getModelColorWithOpacity(e.getDrawableOpacity(i)),f=e.getMultiplyColor(i),v=e.getScreenColor(i);this.gl.uniform4f(h.uniformBaseColorLocation,p.r,p.g,p.b,p.a),this.gl.uniform4f(h.uniformMultiplyColorLocation,f.r,f.g,f.b,f.a),this.gl.uniform4f(h.uniformScreenColorLocation,v.r,v.g,v.b,v.a),null==t._bufferData.index&&(t._bufferData.index=this.gl.createBuffer());const y=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,y,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(r,s,a,n)}setupShaderProgramForMask(t,e,i){t.isPremultipliedAlpha()||L("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders();const r=this._shaderSets.at(pr.ShaderNames_SetupMask);this.gl.useProgram(r.shaderProgram),null==t._bufferData.vertex&&(t._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.vertex);const s=e.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributePositionLocation),this.gl.vertexAttribPointer(r.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==t._bufferData.uv&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const a=e.getDrawableTextureIndex(i),n=t.getBindedTextures().getValue(a);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.uniform1i(r.samplerTexture0Location,0),null==t._bufferData.uv&&(t._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t._bufferData.uv);const o=e.getDrawableVertexUvs(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributeTexCoordLocation),this.gl.vertexAttribPointer(r.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),t.getClippingContextBufferForMask();const l=t.getClippingContextBufferForMask()._layoutChannelIndex,u=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(l);this.gl.uniform4f(r.uniformChannelFlagLocation,u.r,u.g,u.b,u.a),this.gl.uniformMatrix4fv(r.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const h=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(r.uniformBaseColorLocation,2*h.x-1,2*h.y-1,2*h.getRight()-1,2*h.getBottom()-1);const d=e.getMultiplyColor(i),g=e.getScreenColor(i);this.gl.uniform4f(r.uniformMultiplyColorLocation,d.r,d.g,d.b,d.a),this.gl.uniform4f(r.uniformScreenColorLocation,g.r,g.g,g.b,g.a);const c=this.gl.ZERO,_=this.gl.ONE_MINUS_SRC_COLOR,m=this.gl.ZERO,p=this.gl.ONE_MINUS_SRC_ALPHA;null==t._bufferData.index&&(t._bufferData.index=this.gl.createBuffer());const f=e.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,f,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(c,_,m,p)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<10;t++)this._shaderSets.pushBack(new mr);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(fr,vr),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(yr,br),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(Sr,xr),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(Sr,Cr),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return L("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return s?(this.gl.attachShader(i,r),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(s),i):(L("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(s),s=0,i&&(this.gl.deleteProgram(i),i=0),0)):(L("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){const t=this.gl.getShaderInfoLog(r);L("Shader compile log: {0} ",t)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}class mr{constructor(){cr(this,"shaderProgram",void 0),cr(this,"attributePositionLocation",void 0),cr(this,"attributeTexCoordLocation",void 0),cr(this,"uniformMatrixLocation",void 0),cr(this,"uniformClipMatrixLocation",void 0),cr(this,"samplerTexture0Location",void 0),cr(this,"samplerTexture1Location",void 0),cr(this,"uniformBaseColorLocation",void 0),cr(this,"uniformChannelFlagLocation",void 0),cr(this,"uniformMultiplyColorLocation",void 0),cr(this,"uniformScreenColorLocation",void 0)}}let pr=function(t){return t[t.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",t[t.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",t[t.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",t[t.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",t[t.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",t[t.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",t}({});const fr="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",vr="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",yr="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Sr="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",br="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",xr="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",Cr="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";let Pr,Mr,wr,Br,Ir,Tr;function Vr(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismShaderSet=mr,t.CubismShader_WebGL=_r,t.ShaderNames=pr}(Pr||(Pr={}));class Fr extends gr{getMaskRenderTexture(){if(this._maskTexture&&null!=this._maskTexture.textures)this._maskTexture.frameNo=this._currentFrameNo;else{null!=this._maskRenderTextures&&this._maskRenderTextures.clear(),this._maskRenderTextures=new l,null!=this._maskColorBuffers&&this._maskColorBuffers.clear(),this._maskColorBuffers=new l;const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,wr),this._maskTexture=new Er(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}constructor(){super(Rr),Vr(this,"_currentMaskRenderTexture",void 0),Vr(this,"_maskRenderTextures",void 0),Vr(this,"_maskColorBuffers",void 0),Vr(this,"_currentFrameNo",void 0),Vr(this,"_maskTexture",void 0),Vr(this,"gl",void 0)}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let e=0;e<this._clippingContextListForMask.getSize();e++){const r=this._clippingContextListForMask.at(e);this.calcClippedDrawTotalBounds(t,r),r._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new l(this._renderTextureCount));for(let t=0;t<this._clearedFrameBufferFlags.getSize();t++)this._clearedFrameBufferFlags.set(t,!1);for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),s=r._allClippedDrawRect,a=r._layoutBounds,n=.05;let o=0,l=0;const u=this.getMaskRenderTexture().at(r._bufferIndex);this._currentMaskRenderTexture!=u&&(this._currentMaskRenderTexture=u,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(s),this._tmpBoundsOnModel.expand(s.width*n,s.height*n),o=a.width/this._tmpBoundsOnModel.width,l=a.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(o,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(o,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),r._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),r._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const h=r._clippingIdCount;for(let i=0;i<h;i++){const s=r._clippingIdList[i];t.getDrawableDynamicFlagVertexPositionsDidChange(s)&&(e.setIsCulling(0!=t.getDrawableCulling(s)),this._clearedFrameBufferFlags.at(r._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(r._bufferIndex,!0)),e.setClippingContextBufferForMask(r),e.drawMeshWebGL(t,s))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,wr),e.setClippingContextBufferForMask(null),this.gl.viewport(Mr[0],Mr[1],Mr[2],Mr[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}}class Er{constructor(t,e){Vr(this,"frameNo",void 0),Vr(this,"textures",void 0),this.frameNo=t,this.textures=e}}class Rr extends I{constructor(t,e,i){super(e,i),Vr(this,"_owner",void 0),this._owner=t}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class Ar{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){null!=this.gl?(this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)):L("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.")}restore(){null!=this.gl?(this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])):L("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.")}setGl(t){this.gl=t}constructor(){Vr(this,"_lastArrayBufferBinding",void 0),Vr(this,"_lastElementArrayBufferBinding",void 0),Vr(this,"_lastProgram",void 0),Vr(this,"_lastActiveTexture",void 0),Vr(this,"_lastTexture0Binding2D",void 0),Vr(this,"_lastTexture1Binding2D",void 0),Vr(this,"_lastVertexAttribArrayEnabled",void 0),Vr(this,"_lastScissorTest",void 0),Vr(this,"_lastBlend",void 0),Vr(this,"_lastStencilTest",void 0),Vr(this,"_lastDepthTest",void 0),Vr(this,"_lastCullFace",void 0),Vr(this,"_lastFrontFace",void 0),Vr(this,"_lastColorMask",void 0),Vr(this,"_lastBlending",void 0),Vr(this,"_lastFBO",void 0),Vr(this,"_lastViewport",void 0),Vr(this,"gl",void 0),this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class Lr extends P{initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new Fr,this._clippingManager.initialize(t,e)),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new Fr,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),Vr(this,"_textures",void 0),Vr(this,"_sortedDrawableIndexList",void 0),Vr(this,"_clippingManager",void 0),Vr(this,"_clippingContextBufferForMask",void 0),Vr(this,"_clippingContextBufferForDraw",void 0),Vr(this,"_rendererProfile",void 0),Vr(this,"firstDraw",void 0),Vr(this,"_bufferData",void 0),Vr(this,"_extension",void 0),Vr(this,"gl",void 0),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new Ar,this.firstDraw=!0,this._textures=new z,this._sortedDrawableIndexList=new l,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),null!=this.gl&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(null==this.gl)return void L("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.");null!=this._clippingManager&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const t=e[i];this._sortedDrawableIndexList.set(t,i)}for(let e=0;e<t;++e){const t=this._sortedDrawableIndexList.at(e);if(!this.getModel().getDrawableDynamicFlagIsVisible(t))continue;const i=null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw().at(t):null;if(null!=i&&this.isUsingHighPrecisionMask()){i._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i.getClippingManager().getMaskRenderTexture().at(i._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const t=i._clippingIdCount;for(let e=0;e<t;e++){const t=i._clippingIdList[e];this._model.getDrawableDynamicFlagVertexPositionsDidChange(t)&&(this.setIsCulling(0!=this._model.getDrawableCulling(t)),this.setClippingContextBufferForMask(i),this.drawMeshWebGL(this._model,t))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,wr),this.setClippingContextBufferForMask(null),this.gl.viewport(Mr[0],Mr[1],Mr[2],Mr[3]),this.preDraw()}this.setClippingContextBufferForDraw(i),this.setIsCulling(this.getModel().getDrawableCulling(t)),this.drawMeshWebGL(this._model,t)}}drawMeshWebGL(t,e){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?_r.getInstance().setupShaderProgramForMask(this,t,e):_r.getInstance().setupShaderProgramForDraw(this,t,e);{const i=t.getDrawableVertexIndexCount(e);this.gl.drawElements(this.gl.TRIANGLES,i,this.gl.UNSIGNED_SHORT,0)}this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){_r.deleteInstance()}setRenderState(t,e){wr=t,Mr=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return null!=this.getClippingContextBufferForMask()}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),_r.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}function Dr(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}P.staticRelease=()=>{Lr.doStaticRelease()},function(t){t.CubismClippingContext=Rr,t.CubismClippingManager_WebGL=Fr,t.CubismRenderTextureResource=Er,t.CubismRenderer_WebGL=Lr}(Br||(Br={}));class kr{constructor(t=!1,e=new B){Dr(this,"isOverwritten",void 0),Dr(this,"color",void 0),this.isOverwritten=t,this.color=e}}class Or{constructor(t=!1,e=new B){Dr(this,"isOverwritten",void 0),Dr(this,"color",void 0),this.isOverwritten=t,this.color=e}}class Nr{constructor(t=!1,e=!1){Dr(this,"isOverwritten",void 0),Dr(this,"isCulling",void 0),this.isOverwritten=t,this.isCulling=e}}class jr{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return null==this._model?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setMultiplyColorByRGBA(t,e,i,r,s=1){this._userMultiplyColors.at(t).color.r=e,this._userMultiplyColors.at(t).color.g=i,this._userMultiplyColors.at(t).color.b=r,this._userMultiplyColors.at(t).color.a=s}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setScreenColorByRGBA(t,e,i,r,s=1){this._userScreenColors.at(t).color.r=e,this._userScreenColors.at(t).color.g=i,this._userScreenColors.at(t).color.b=r,this._userScreenColors.at(t).color.a=s}getPartMultiplyColor(t){return this._userPartMultiplyColors.at(t).color}getPartScreenColor(t){return this._userPartScreenColors.at(t).color}setPartColor(t,e,i,r,s,a,n){if(a.at(t).color.r=e,a.at(t).color.g=i,a.at(t).color.b=r,a.at(t).color.a=s,a.at(t).isOverwritten)for(let a=0;a<this._partChildDrawables.at(t).getSize();++a){const o=this._partChildDrawables.at(t).at(a);n.at(o).color.r=e,n.at(o).color.g=i,n.at(o).color.b=r,n.at(o).color.a=s}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartMultiplyColorByRGBA(t,e,i,r,s){this.setPartColor(t,e,i,r,s,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.r,e.g,e.b,e.a)}setPartScreenColorByRGBA(t,e,i,r,s){this.setPartColor(t,e,i,r,s,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors.at(t).isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors.at(t).isOverwritten}setOverwriteColorForPartColors(t,e,i,r){i.at(t).isOverwritten=e;for(let s=0;s<this._partChildDrawables.at(t).getSize();++s){const a=this._partChildDrawables.at(t).at(s);r.at(a).isOverwritten=e,e&&(r.at(a).color.r=i.at(t).color.r,r.at(a).color.g=i.at(t).color.g,r.at(a).color.b=i.at(t).color.b,r.at(a).color.a=i.at(t).color.a)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings.at(t).isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings.at(t).isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings.at(t).isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartId(t){const e=this._model.parts.ids[t];return ht.getIdManager().getId(e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.setValue(t,e):(V(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e)}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(V(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterId(t){return ht.getIdManager().getId(this._model.parameters.ids[t])}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(V(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){this._notExistParameterValues.isExist(t)?this._notExistParameterValues.setValue(t,1==i?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i):(V(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=1==i?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i)}setParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,i)}multiplyParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return ht.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=4*t,r=new B;return r.r=e[i],r.g=e[i+1],r.b=e[i+2],r.a=e[i+3],r}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=4*t,r=new B;return r.r=e[i],r.g=e[i+1],r.b=e[i+2],r.a=e[i+3],r}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?w.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?w.CubismBlendMode_Multiplicative:w.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let e=0;e<t;++e)this._parameterValues[e]=this._savedParameters.at(e)}initialize(){V(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(let i=0;i<e;++i)this._parameterIds.pushBack(ht.getIdManager().getId(t[i]))}const t=this._model.parts.count;{const e=this._model.parts.ids;this._partIds.prepareCapacity(t);for(let i=0;i<t;++i)this._partIds.pushBack(ht.getIdManager().getId(e[i]));this._userPartMultiplyColors.prepareCapacity(t),this._userPartScreenColors.prepareCapacity(t),this._partChildDrawables.prepareCapacity(t)}{const e=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);const r=new Nr(!1,!1);for(let e=0;e<t;++e){const t=new B(1,1,1,1),r=new B(0,0,0,1),s=new Or(!1,t),a=new Or(!1,r);this._userPartMultiplyColors.pushBack(s),this._userPartScreenColors.pushBack(a),this._partChildDrawables.pushBack(new l),this._partChildDrawables.at(e).prepareCapacity(i)}for(let t=0;t<i;++t){const i=new B(1,1,1,1),s=new B(0,0,0,1),a=new kr(!1,i),n=new kr(!1,s);this._drawableIds.pushBack(ht.getIdManager().getId(e[t])),this._userMultiplyColors.pushBack(a),this._userScreenColors.pushBack(n),this._userCullings.pushBack(r);const o=this.getDrawableParentPartIndex(t);o>=0&&this._partChildDrawables.at(o).pushBack(t)}}}constructor(t){Dr(this,"_notExistPartOpacities",void 0),Dr(this,"_notExistPartId",void 0),Dr(this,"_notExistParameterValues",void 0),Dr(this,"_notExistParameterId",void 0),Dr(this,"_savedParameters",void 0),Dr(this,"_isOverwrittenModelMultiplyColors",void 0),Dr(this,"_isOverwrittenModelScreenColors",void 0),Dr(this,"_userMultiplyColors",void 0),Dr(this,"_userScreenColors",void 0),Dr(this,"_userPartScreenColors",void 0),Dr(this,"_userPartMultiplyColors",void 0),Dr(this,"_partChildDrawables",void 0),Dr(this,"_model",void 0),Dr(this,"_parameterValues",void 0),Dr(this,"_parameterMaximumValues",void 0),Dr(this,"_parameterMinimumValues",void 0),Dr(this,"_partOpacities",void 0),Dr(this,"_modelOpacity",void 0),Dr(this,"_parameterIds",void 0),Dr(this,"_partIds",void 0),Dr(this,"_drawableIds",void 0),Dr(this,"_isOverwrittenCullings",void 0),Dr(this,"_userCullings",void 0),this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new l,this._parameterIds=new l,this._drawableIds=new l,this._partIds=new l,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=new l,this._userScreenColors=new l,this._userCullings=new l,this._userPartMultiplyColors=new l,this._userPartScreenColors=new l,this._partChildDrawables=new l,this._notExistPartId=new z,this._notExistParameterId=new z,this._notExistParameterValues=new z,this._notExistPartOpacities=new z}release(){this._model.release(),this._model=null}}function zr(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismModel=jr}(Ir||(Ir={}));class Ur{static create(t,e){let i=null;if(e&&!this.hasMocConsistency(t))return L("Inconsistent MOC3."),i;const r=Live2DCubismCore.Moc.fromArrayBuffer(t);return r&&(i=new Ur(r),i._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,t)),i}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new jr(e),t.initialize(),++this._modelCount),t}deleteModel(t){null!=t&&(t.release(),t=null,--this._modelCount)}constructor(t){zr(this,"_moc",void 0),zr(this,"_modelCount",void 0),zr(this,"_mocVersion",void 0),this._moc=t,this._modelCount=0,this._mocVersion=0}release(){V(0==this._modelCount),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return 1===Live2DCubismCore.Moc.prototype.hasMocConsistency(t)}}!function(t){t.CubismMoc=Ur}(Tr||(Tr={}));const Xr="Meta",Yr="UserData";class Gr{constructor(t,e){(function(t,e,i){(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i})(this,"_json",void 0),this._json=q.create(t,e)}release(){q.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(Xr).getValueByString("UserDataCount").toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(Xr).getValueByString("TotalUserDataSize").toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(Yr).getValueByIndex(t).getValueByString("Target").getRawString()}getUserDataId(t){return ht.getIdManager().getId(this._json.getRoot().getValueByString(Yr).getValueByIndex(t).getValueByString("Id").getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(Yr).getValueByIndex(t).getValueByString("Value").getRawString()}}let Hr,qr,Wr;function $r(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismModelUserDataJson=Gr}(Hr||(Hr={}));class Jr{constructor(){$r(this,"targetType",void 0),$r(this,"targetId",void 0),$r(this,"value",void 0)}}class Zr{static create(t,e){const i=new Zr;return i.parseUserData(t,e),i}static delete(t){null!=t&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new Gr(t,e);if(!i)return i.release(),void(i=void 0);const r=ht.getIdManager().getId("ArtMesh"),s=i.getUserDataCount();for(let t=0;t<s;t++){const e=new Jr;e.targetId=i.getUserDataId(t),e.targetType=ht.getIdManager().getId(i.getUserDataTargetType(t)),e.value=new g(i.getUserDataValue(t)),this._userDataNodes.pushBack(e),e.targetType==r&&this._artMeshUserDataNode.pushBack(e)}i.release(),i=void 0}constructor(){$r(this,"_userDataNodes",void 0),$r(this,"_artMeshUserDataNode",void 0),this._userDataNodes=new l,this._artMeshUserDataNode=new l}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}function Kr(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismModelUserData=Zr,t.CubismModelUserDataNode=Jr}(qr||(qr={}));class Qr{isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t,e=!1){this._moc=Ur.create(t,e),null!=this._moc?(this._model=this._moc.createModel(),null!=this._model?(this._model.saveParameters(),this._modelMatrix=new ae(this._model.getCanvasWidth(),this._model.getCanvasHeight())):L("Failed to CreateModel().")):L("Failed to CubismMoc.create().")}loadMotion(t,e,i,r){return null==t||0==e?(L("Failed to loadMotion()."),null):ui.create(t,e,r)}loadExpression(t,e,i){return null==t||0==e?(L("Failed to loadExpression()."),null):be.create(t,e)}loadPose(t,e){null!=t&&0!=e?this._pose=Qt.create(t,e):L("Failed to loadPose().")}loadUserData(t,e){null!=t&&0!=e?this._modelUserData=Zr.create(t,e):L("Failed to loadUserData().")}loadPhysics(t,e){null!=t&&0!=e?this._physics=qi.create(t,e):L("Failed to loadPhysics().")}isHit(t,e,i){const r=this._model.getDrawableIndex(t);if(r<0)return!1;const s=this._model.getDrawableVertexCount(r),a=this._model.getDrawableVertices(r);let n=a[0],o=a[0],l=a[1],u=a[1];for(let t=1;t<s;++t){const e=a[lt.vertexOffset+t*lt.vertexStep],i=a[lt.vertexOffset+t*lt.vertexStep+1];e<n&&(n=e),e>o&&(o=e),i<l&&(l=i),i>u&&(u=i)}const h=this._modelMatrix.invertTransformX(e),d=this._modelMatrix.invertTransformY(i);return n<=h&&h<=o&&l<=d&&d<=u}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new Lr,this._renderer.initialize(this._model,t)}deleteRenderer(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){R("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){null!=i&&i.motionEventFired(e)}constructor(){Kr(this,"_moc",void 0),Kr(this,"_model",void 0),Kr(this,"_motionManager",void 0),Kr(this,"_expressionManager",void 0),Kr(this,"_eyeBlink",void 0),Kr(this,"_breath",void 0),Kr(this,"_modelMatrix",void 0),Kr(this,"_pose",void 0),Kr(this,"_dragManager",void 0),Kr(this,"_physics",void 0),Kr(this,"_modelUserData",void 0),Kr(this,"_initialized",void 0),Kr(this,"_updating",void 0),Kr(this,"_opacity",void 0),Kr(this,"_lipsync",void 0),Kr(this,"_lastLipSyncValue",void 0),Kr(this,"_dragX",void 0),Kr(this,"_dragY",void 0),Kr(this,"_accelerationX",void 0),Kr(this,"_accelerationY",void 0),Kr(this,"_accelerationZ",void 0),Kr(this,"_mocConsistency",void 0),Kr(this,"_debugMode",void 0),Kr(this,"_renderer",void 0),this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new ci,this._motionManager.setEventCallback(Qr.cubismDefaultMotionEventCallback,this),this._expressionManager=new Le,this._dragManager=new me}release(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Qt.delete(this._pose),qt.delete(this._eyeBlink),Yt.delete(this._breath),this._dragManager=null,qi.delete(this._physics),Zr.delete(this._modelUserData),this.deleteRenderer()}}function ts(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismUserModel=Qr}(Wr||(Wr={}));class es{static loadFileAsBytes(t,e){fetch(t).then((t=>t.arrayBuffer())).then((t=>e(t,t.byteLength)))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(t){console.log(t)}}function is(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}ts(es,"lastUpdate",Date.now()),ts(es,"s_currentFrame",0),ts(es,"s_lastFrame",0),ts(es,"s_deltaTime",0);let rs=null;class ss{static getInstance(){return null==rs&&(rs=new ss),rs}static releaseInstance(){null!=rs&&(rs=void 0),rs=null}update(t){let e,i;if(null==this._pcmData||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=t,e=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate),e>this._wavFileInfo._samplesPerChannel&&(e=this._wavFileInfo._samplesPerChannel),i=0;for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)for(let r=this._sampleOffset;r<e;r++){const e=this._pcmData[t][r];i+=e*e}return i=Math.sqrt(i/(this._wavFileInfo._numberOfChannels*(e-this._sampleOffset))),this._lastRms=i,this._sampleOffset=e,!0}start(t){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(t)}getRms(){return this._lastRms}loadWavFile(t){return new Promise((e=>{let i=!1;null!=this._pcmData&&this.releasePcmData(),(async()=>{if(this._byteReader._fileByte=await(async()=>fetch(t).then((t=>t.arrayBuffer())))(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,null==this._byteReader._fileByte||this._byteReader._fileSize<4)e(!1);else{this._wavFileInfo._fileName=t;try{if(!this._byteReader.getCheckSignature("RIFF"))throw i=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw i=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw i=!1,new Error('Cannot find Signeture "fmt".');const t=this._byteReader.get32LittleEndian();if(1!==this._byteReader.get16LittleEndian())throw i=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),t>16&&(this._byteReader._readOffset+=t-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw i=!1,new Error('Cannot find "data" Chunk.');{const t=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=8*t/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)this._pcmData[t]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let t=0;t<this._wavFileInfo._samplesPerChannel;t++)for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)this._pcmData[e][t]=this.getPcmSample();i=!0,e(i)}catch(t){console.log(t)}}})().then((()=>{e(i)}))}))}getPcmSample(){let t;switch(this._wavFileInfo._bitsPerSample){case 8:t=this._byteReader.get8()-128,t<<=24;break;case 16:t=this._byteReader.get16LittleEndian()<<16;break;case 24:t=this._byteReader.get24LittleEndian()<<8;break;default:t=0}return t/2147483647}getPcmDataChannel(t){return this._pcmData&&t<this._pcmData.length?Float32Array.from(this._pcmData[t]):null}getWavSamplingRate(){return!this._wavFileInfo||this._wavFileInfo._samplingRate<1?null:this._wavFileInfo._samplingRate}releasePcmData(){for(let e=0;e<this._wavFileInfo._numberOfChannels;e++){var t;null===(t=this._pcmData)||void 0===t||delete t[e]}delete this._pcmData,this._pcmData=null}constructor(){is(this,"_pcmData",void 0),is(this,"_userTimeSeconds",void 0),is(this,"_lastRms",void 0),is(this,"_sampleOffset",void 0),is(this,"_wavFileInfo",void 0),is(this,"_byteReader",void 0),is(this,"_loadFiletoBytes",((t,e)=>{this._byteReader._fileByte=t,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=e})),this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new as,this._byteReader=new ns}}class as{constructor(){is(this,"_fileName",void 0),is(this,"_numberOfChannels",void 0),is(this,"_bitsPerSample",void 0),is(this,"_samplingRate",void 0),is(this,"_samplesPerChannel",void 0),this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class ns{constructor(){is(this,"_fileByte",void 0),is(this,"_fileDataView",void 0),is(this,"_fileSize",void 0),is(this,"_readOffset",void 0),this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){if(!this._fileDataView)return 0;const t=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,t}get16LittleEndian(){if(!this._fileDataView)return 0;const t=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,t}get24LittleEndian(){if(!this._fileDataView)return 0;const t=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,t}get32LittleEndian(){if(!this._fileDataView)return 0;const t=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,t}getCheckSignature(t){const e=new Uint8Array(4),i=(new TextEncoder).encode(t);if(4!==t.length)return!1;for(let t=0;t<4;t++)e[t]=this.get8();return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}}function os(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var ls=function(t){return t[t.LoadAssets=0]="LoadAssets",t[t.LoadModel=1]="LoadModel",t[t.WaitLoadModel=2]="WaitLoadModel",t[t.LoadExpression=3]="LoadExpression",t[t.WaitLoadExpression=4]="WaitLoadExpression",t[t.LoadPhysics=5]="LoadPhysics",t[t.WaitLoadPhysics=6]="WaitLoadPhysics",t[t.LoadPose=7]="LoadPose",t[t.WaitLoadPose=8]="WaitLoadPose",t[t.SetupEyeBlink=9]="SetupEyeBlink",t[t.SetupBreath=10]="SetupBreath",t[t.LoadUserData=11]="LoadUserData",t[t.WaitLoadUserData=12]="WaitLoadUserData",t[t.SetupEyeBlinkIds=13]="SetupEyeBlinkIds",t[t.SetupLipSyncIds=14]="SetupLipSyncIds",t[t.SetupLayout=15]="SetupLayout",t[t.LoadMotion=16]="LoadMotion",t[t.WaitLoadMotion=17]="WaitLoadMotion",t[t.CompleteInitialize=18]="CompleteInitialize",t[t.CompleteSetupModel=19]="CompleteSetupModel",t[t.LoadTexture=20]="LoadTexture",t[t.WaitLoadTexture=21]="WaitLoadTexture",t[t.CompleteSetup=22]="CompleteSetup",t}(ls||{});class us extends Qr{loadAssets(t,e){return this._modelHomeDir=t,fetch(`${this._modelHomeDir}${e}`).then((t=>t.arrayBuffer())).then((t=>{const e=new jt(t,t.byteLength);return this._state=ls.LoadModel,this.setupModel(e)})).catch((t=>{throw L(`Failed to load file ${this._modelHomeDir}${e}`),t}))}setupModel(t){return new Promise((e=>{if(this._updating=!0,this._initialized=!1,this._modelSetting=t,""!==this._modelSetting.getModelFileName()){const t=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}${t}`).then((e=>{if(e.ok)return e.arrayBuffer();if(e.status>=400)return L(`Failed to load file ${this._modelHomeDir}${t}`),new ArrayBuffer(0);throw e})).then((t=>{this.loadModel(t,this._mocConsistency),this._state=ls.LoadExpression,i()})),this._state=ls.WaitLoadModel}else es.printMessage("Model data does not exist.");const i=()=>{if(this._modelSetting)if(this._modelSetting.getExpressionCount()>0){const t=this._modelSetting.getExpressionCount();for(let e=0;e<t;e++){const i=this._modelSetting.getExpressionName(e),s=this._modelSetting.getExpressionFileName(e);fetch(`${this._modelHomeDir}${s}`).then((t=>{if(t.ok)return t.arrayBuffer();if(t.status>=400)return L(`Failed to load file ${this._modelHomeDir}${s}`),new ArrayBuffer(0);throw t})).then((e=>{const s=this.loadExpression(e,e.byteLength,i);null!=this._expressions.getValue(i)&&(fe.delete(this._expressions.getValue(i)),this._expressions.setValue(i,null)),this._expressions.setValue(i,s),this._expressionCount++,this._expressionCount>=t&&(this._state=ls.LoadPhysics,r())}))}this._state=ls.WaitLoadExpression}else this._state=ls.LoadPhysics,r()},r=()=>{if(this._modelSetting)if(""!==this._modelSetting.getPhysicsFileName()){const t=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}${t}`).then((e=>{if(e.ok)return e.arrayBuffer();if(e.status>=400)return L(`Failed to load file ${this._modelHomeDir}${t}`),new ArrayBuffer(0);throw e})).then((t=>{this.loadPhysics(t,t.byteLength),this._state=ls.LoadPose,s()})),this._state=ls.WaitLoadPhysics}else this._state=ls.LoadPose,s()},s=()=>{if(this._modelSetting)if(""!==this._modelSetting.getPoseFileName()){const t=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}${t}`).then((e=>{if(e.ok)return e.arrayBuffer();if(e.status>=400)return L(`Failed to load file ${this._modelHomeDir}${t}`),new ArrayBuffer(0);throw e})).then((t=>{this.loadPose(t,t.byteLength),this._state=ls.SetupEyeBlink,a()})),this._state=ls.WaitLoadPose}else this._state=ls.SetupEyeBlink,a()},a=()=>{this._modelSetting&&(this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=qt.create(this._modelSetting),this._state=ls.SetupBreath),n())},n=()=>{this._breath=Yt.create();const t=new l;t.pushBack(new Gt(this._idParamAngleX,0,15,6.5345,.5)),t.pushBack(new Gt(this._idParamAngleY,0,8,3.5345,.5)),t.pushBack(new Gt(this._idParamAngleZ,0,10,5.5345,.5)),t.pushBack(new Gt(this._idParamBodyAngleX,0,4,15.5345,.5)),t.pushBack(new Gt(ht.getIdManager().getId(Pt.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(t),this._state=ls.LoadUserData,o()},o=()=>{if(this._modelSetting)if(""!==this._modelSetting.getUserDataFile()){const t=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}${t}`).then((e=>{if(e.ok)return e.arrayBuffer();if(e.status>=400)return L(`Failed to load file ${this._modelHomeDir}${t}`),new ArrayBuffer(0);throw e})).then((t=>{this.loadUserData(t,t.byteLength),this._state=ls.SetupEyeBlinkIds,u()})),this._state=ls.WaitLoadUserData}else this._state=ls.SetupEyeBlinkIds,u()},u=()=>{if(!this._modelSetting)return;const t=this._modelSetting.getEyeBlinkParameterCount();for(let e=0;e<t;++e)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(e));this._state=ls.SetupLipSyncIds,h()},h=()=>{if(!this._modelSetting)return;const t=this._modelSetting.getLipSyncParameterCount();for(let e=0;e<t;++e)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(e));this._state=ls.SetupLayout,d()},d=()=>{const t=new z;null!=this._modelSetting&&null!=this._modelMatrix?(this._modelSetting.getLayoutMap(t),this._modelMatrix.setupFromLayout(t),this._state=ls.LoadMotion,g()):L("Failed to setupLayout().")},g=()=>{if(!this._modelSetting)return;this._state=ls.WaitLoadMotion,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const t=[],i=this._modelSetting.getMotionGroupCount();for(let e=0;e<i;e++)t[e]=this._modelSetting.getMotionGroupName(e),this._allMotionCount+=this._modelSetting.getMotionCount(t[e]);for(let r=0;r<i;r++)this.preLoadMotionGroup(t[r]).then(e);0===i&&(this._state=ls.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),bt&&this.getRenderer().startUp(bt),e(this))}}))}setupTextures(){if(!this._modelSetting)return;const t=!0;if(this._state===ls.LoadTexture){const i=this._modelSetting.getTextureCount();for(let r=0;r<i;r++){var e;if(""===this._modelSetting.getTextureFileName(r)){console.log("getTextureFileName null");continue}let s=this._modelSetting.getTextureFileName(r);s=this._modelHomeDir+s;const a=t=>{t.id&&this.getRenderer().bindTexture(r,t.id),this._textureCount++,this._textureCount>=i&&(this._state=ls.CompleteSetup)};null===(e=Ts.getInstance().getTextureManager())||void 0===e||e.createTextureFromPngFile(s,t,a),this.getRenderer().setIsPremultipliedAlpha(t)}this._state=ls.WaitLoadTexture}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){var t,e,i;if(this._state!==ls.CompleteSetup)return;const r=es.getDeltaTime();this._userTimeSeconds+=r,null===(t=this._dragManager)||void 0===t||t.update(r),this._dragX=null===(e=this._dragManager)||void 0===e?void 0:e.getX(),this._dragY=null===(i=this._dragManager)||void 0===i?void 0:i.getY();let s=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion("Idle",1):s=this._motionManager.updateMotion(this._model,r),this._model.saveParameters(),s||null!=this._eyeBlink&&this._eyeBlink.updateParameters(this._model,r),null!=this._expressionManager&&this._expressionManager.updateMotion(this._model,r),this._model.addParameterValueById(this._idParamAngleX,30*this._dragX),this._model.addParameterValueById(this._idParamAngleY,30*this._dragY),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,10*this._dragX),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),null!=this._breath&&this._breath.updateParameters(this._model,r),null!=this._physics&&this._physics.evaluate(this._model,r),this._lipsync){let t=0;this._wavFileHandler.update(r),t=this._wavFileHandler.getRms();for(let e=0;e<this._lipSyncIds.getSize();++e)this._model.addParameterValueById(this._lipSyncIds.at(e),t,.8)}null!=this._pose&&this._pose.updateParameters(this._model,r),this._model.update()}startMotion(t,e,i,r){if(!this._modelSetting)return;if(3===i)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&es.printMessage("[APP]can't start motion."),Ve;const s=this._modelSetting.getMotionFileName(t,e),a=`${t}_${e}`;let n=this._motions.getValue(a),o=!1;this.onMotionStart(this,{motion:n,name:a,group:t,no:e,priority:i});const l=s=>{this.onMotionEnd(this,{motion:s,name:a,group:t,no:e,priority:i}),null==r||r(s)};null==n?fetch(`${this._modelHomeDir}${s}`).then((t=>{if(t.ok)return t.arrayBuffer();if(t.status>=400)return L(`Failed to load file ${this._modelHomeDir}${s}`),new ArrayBuffer(0);throw t})).then((i=>{if(n=this.loadMotion(i,i.byteLength,null,l),null==n)return;if(!this._modelSetting)return;let r=this._modelSetting.getMotionFadeInTimeValue(t,e);r>=0&&n.setFadeInTime(r),r=this._modelSetting.getMotionFadeOutTimeValue(t,e),r>=0&&n.setFadeOutTime(r),n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),o=!0})):l&&n.setFinishedMotionHandler(l);const u=this._modelSetting.getMotionSoundFileName(t,e);if(0!==u.localeCompare("")){let t=u;t=this._modelHomeDir+t,this._wavFileHandler.start(t)}return this._debugMode&&es.printMessage(`[APP]start motion: [${t}_${e}`),this._motionManager.startMotionPriority(n,o,i)}startRandomMotion(t,e,i){if(!this._modelSetting)return;if(0===this._modelSetting.getMotionCount(t))return Ve;const r=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,r,e,i)}setExpression(t){const e=this._expressions.getValue(t);this._debugMode&&es.printMessage(`[APP]expression: [${t}]`),null!=e?(this.onExpression(this,{motion:e,id:t,priority:3}),this._expressionManager.startMotionPriority(e,!1,3)):this._debugMode&&es.printMessage(`[APP]expression[${t}] is null`)}setRandomExpression(){if(0===this._expressions.getSize())return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let e=0;e<this._expressions.getSize();e++)if(e===t){const t=this._expressions._keyValues[e].first;return void this.setExpression(t)}}motionEventFired(t){R("{0} is fired on LAppModel!!",t.s)}hitTest(t,e,i){if(!this._modelSetting)return!1;if(this._opacity<1)return!1;const r=this._modelSetting.getHitAreasCount();for(let s=0;s<r;s++)if(this._modelSetting.getHitAreaName(s)===t){const t=this._modelSetting.getHitAreaId(s);return this.isHit(t,e,i)}return!1}preLoadMotionGroup(t){return new Promise((e=>{if(this._modelSetting)for(let i=0;i<this._modelSetting.getMotionCount(t);i++){const r=this._modelSetting.getMotionFileName(t,i),s=`${t}_${i}`;this._debugMode&&es.printMessage(`[APP]load motion: ${r} => [${s}]`),fetch(`${this._modelHomeDir}${r}`).then((t=>{if(t.ok)return t.arrayBuffer();if(t.status>=400)return L(`Failed to load file ${this._modelHomeDir}${r}`),new ArrayBuffer(0);throw t})).then((r=>{const a=this.loadMotion(r,r.byteLength,s);if(this._modelSetting)if(null!=a){let r=this._modelSetting.getMotionFadeInTimeValue(t,i);r>=0&&a.setFadeInTime(r),r=this._modelSetting.getMotionFadeOutTimeValue(t,i),r>=0&&a.setFadeOutTime(r),a.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),null!=this._motions.getValue(s)&&fe.delete(this._motions.getValue(s)),this._motions.setValue(s,a),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=ls.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),bt&&this.getRenderer().startUp(bt),e(this))}else this._allMotionCount--}))}}))}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(null==this._model)return;if(!St)return;const t=[0,0,St.width,St.height];this.getRenderer().setRenderState(Bs,t),this.getRenderer().drawModel()}draw(t){null!=this._model&&this._state===ls.CompleteSetup&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}async hasMocConsistencyFromFile(){if(this._modelSetting){if(V(this._modelSetting.getModelFileName().localeCompare("")),""!==this._modelSetting.getModelFileName()){const t=this._modelSetting.getModelFileName(),e=await fetch(`${this._modelHomeDir}${t}`),i=await e.arrayBuffer();return this._consistency=Ur.hasMocConsistency(i),this._consistency?R("Consistent MOC3."):R("Inconsistent MOC3."),this._consistency}es.printMessage("Model data does not exist.")}}constructor(){super(),os(this,"_initialized",!1),os(this,"_modelSetting",void 0),os(this,"_modelHomeDir",void 0),os(this,"_userTimeSeconds",void 0),os(this,"_eyeBlinkIds",void 0),os(this,"_lipSyncIds",void 0),os(this,"_motions",void 0),os(this,"_expressions",void 0),os(this,"_hitArea",void 0),os(this,"_userArea",void 0),os(this,"_idParamAngleX",void 0),os(this,"_idParamAngleY",void 0),os(this,"_idParamAngleZ",void 0),os(this,"_idParamEyeBallX",void 0),os(this,"_idParamEyeBallY",void 0),os(this,"_idParamBodyAngleX",void 0),os(this,"_state",void 0),os(this,"_expressionCount",void 0),os(this,"_textureCount",void 0),os(this,"_motionCount",void 0),os(this,"_allMotionCount",void 0),os(this,"_wavFileHandler",void 0),os(this,"_consistency",void 0),os(this,"onMotionStart",(()=>{})),os(this,"onMotionEnd",(()=>{})),os(this,"onExpression",(()=>{})),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new l,this._lipSyncIds=new l,this._motions=new z,this._expressions=new z,this._hitArea=new l,this._userArea=new l,this._idParamAngleX=ht.getIdManager().getId(Pt.ParamAngleX),this._idParamAngleY=ht.getIdManager().getId(Pt.ParamAngleY),this._idParamAngleZ=ht.getIdManager().getId(Pt.ParamAngleZ),this._idParamEyeBallX=ht.getIdManager().getId(Pt.ParamEyeBallX),this._idParamEyeBallY=ht.getIdManager().getId(Pt.ParamEyeBallY),this._idParamBodyAngleX=ht.getIdManager().getId(Pt.ParamBodyAngleX),this._mocConsistency=!0,this._state=ls.LoadAssets,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new ss,this._consistency=!1}}function hs(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let ds,gs=null;class cs{static getInstance(){return null==gs&&(gs=new cs),gs}static releaseInstance(){null!=gs&&(gs=void 0),gs=null}getModel(t){return t<this._models.getSize()?this._models.at(t):null}releaseAllModel(){for(let t=0;t<this._models.getSize();t++)this._models.at(t).release(),this._models.set(t,null);this._models.clear()}onDrag(t,e){for(let i=0;i<this._models.getSize();i++){const r=this.getModel(i);r&&r.setDragging(t,e)}}onTap(t,e){const i=t/this._viewMatrix.getScaleX()-this._viewMatrix.getTranslateX(),r=e/this._viewMatrix.getScaleY()-this._viewMatrix.getTranslateY();es.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${e.toFixed(2)}, calibrateX: ${i.toFixed(2)} calibrateY: ${r.toFixed(2)}}`);for(let t=0;t<this._models.getSize();t++)this._models.at(t).hitTest(ft,i,r)?(es.printMessage(`[APP]hit area: [${ft}]`),this._models.at(t).setRandomExpression()):this._models.at(t).hitTest(vt,i,r)&&(es.printMessage(`[APP]hit area: [${vt}]`),this._models.at(t).startRandomMotion("TapBody",2,this._finishedMotion))}onUpdate(){if(!St)return;const{width:t,height:e}=St,i=this._models.getSize();for(let r=0;r<i;++r){const i=new S,s=this.getModel(r);s&&(s.getModel()&&(s.getModel().getCanvasWidth()>1&&t<e?(s.getModelMatrix().setWidth(2),i.scale(1,t/e)):i.scale(e/t,1),null!=this._viewMatrix&&i.multiplyByMatrix(this._viewMatrix)),s.update(),s.draw(i))}}setViewMatrix(t){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=t.getArray()[e]}constructor(){hs(this,"_viewMatrix",void 0),hs(this,"_models",void 0),hs(this,"_finishedMotion",(t=>{es.printMessage("Motion Finished:"),console.log(t)})),this._viewMatrix=new S,this._models=new l}loadModel(t){return es.printMessage(`[APP]model name: ${t}`),this.releaseAllModel(),this._models.pushBack(new us),this._models.at(0).loadAssets(_t+t+"/",t+".model3.json")}}function _s(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ms{constructor(){_s(this,"_textures",void 0),this._textures=new l}release(){if(bt&&this._textures){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())bt.deleteTexture(t.ptr().id);this._textures=null}}createTextureFromPngFile(t,e,i){if(!this._textures)return;for(let r=this._textures.begin();r.notEqual(this._textures.end());r.preIncrement())if(r.ptr().fileName===t&&r.ptr().usePremultply===e)return r.ptr().img=new Image,r.ptr().img.addEventListener("load",(()=>i(r.ptr())),{passive:!0}),void(r.ptr().img.src=t);const r=new Image;r.addEventListener("load",(()=>{if(!bt)return;if(!this._textures)return;const s=bt.createTexture();if(!s)return;bt.bindTexture(bt.TEXTURE_2D,s),bt.texParameteri(bt.TEXTURE_2D,bt.TEXTURE_MIN_FILTER,bt.LINEAR_MIPMAP_LINEAR),bt.texParameteri(bt.TEXTURE_2D,bt.TEXTURE_MAG_FILTER,bt.LINEAR),e&&bt.pixelStorei(bt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),bt.texImage2D(bt.TEXTURE_2D,0,bt.RGBA,bt.RGBA,bt.UNSIGNED_BYTE,r),bt.generateMipmap(bt.TEXTURE_2D),bt.bindTexture(bt.TEXTURE_2D,null);const a=new ps;null!=a&&(a.fileName=t,a.width=r.width,a.height=r.height,a.id=s,a.img=r,a.usePremultply=e,this._textures.pushBack(a)),i(a)}),{passive:!0}),r.src=t}releaseTextures(){if(this._textures){for(let t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()}}releaseTextureByTexture(t){if(this._textures)for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id===t){this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){if(this._textures)for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName===t){this._textures.set(e,null),this._textures.remove(e);break}}}class ps{constructor(){_s(this,"img",null),_s(this,"id",null),_s(this,"width",0),_s(this,"height",0),_s(this,"usePremultply",!1),_s(this,"fileName","")}}function fs(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class vs extends S{constructor(){super(),fs(this,"_screenLeft",void 0),fs(this,"_screenRight",void 0),fs(this,"_screenTop",void 0),fs(this,"_screenBottom",void 0),fs(this,"_maxLeft",void 0),fs(this,"_maxRight",void 0),fs(this,"_maxTop",void 0),fs(this,"_maxBottom",void 0),fs(this,"_maxScale",void 0),fs(this,"_minScale",void 0),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);S.multiply(i,this._tr,this._tr)}resetTranslate(){this.adjustTranslate(-this.getTranslateX(),-this.getTranslateY())}adjustScale(t,e,i){const r=this.getMaxScale(),s=this.getMinScale(),a=i*this._tr[0];a<s?this._tr[0]>0&&(i=s/this._tr[0]):a>r&&this._tr[0]>0&&(i=r/this._tr[0]);const n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),o=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);S.multiply(l,this._tr,this._tr),S.multiply(o,this._tr,this._tr),S.multiply(n,this._tr,this._tr)}resetScale(){const t=this._tr[0];this.adjustScale(this.getTranslateX(),this.getTranslateY(),1/t)}setScreenRect(t,e,i,r){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=r}setMaxScreenRect(t,e,i,r){this._maxLeft=t,this._maxRight=e,this._maxTop=r,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}function ys(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.CubismViewMatrix=vs}(ds||(ds={}));class Ss{constructor(t,e,i,r,s){ys(this,"_texture",void 0),ys(this,"_vertexBuffer",void 0),ys(this,"_uvBuffer",void 0),ys(this,"_indexBuffer",void 0),ys(this,"_rect",void 0),ys(this,"_positionLocation",void 0),ys(this,"_uvLocation",void 0),ys(this,"_textureLocation",void 0),ys(this,"_positionArray",void 0),ys(this,"_uvArray",void 0),ys(this,"_indexArray",void 0),ys(this,"_firstDraw",void 0),this._rect=new bs,this._rect.left=t-.5*i,this._rect.right=t+.5*i,this._rect.up=e+.5*r,this._rect.down=e-.5*r,this._texture=s,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null,null==bt||bt.deleteTexture(this._texture),this._texture=null,null==bt||bt.deleteBuffer(this._uvBuffer),this._uvBuffer=null,null==bt||bt.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,null==bt||bt.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(t){var e,i,r,s;if(bt&&St&&null!=this._texture){if(this._firstDraw){if(this._positionLocation=bt.getAttribLocation(t,"position"),bt.enableVertexAttribArray(this._positionLocation),this._uvLocation=bt.getAttribLocation(t,"uv"),bt.enableVertexAttribArray(this._uvLocation),this._textureLocation=bt.getUniformLocation(t,"texture"),bt.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=bt.createBuffer(),this._rect){const t=St.width,e=St.height;this._positionArray=new Float32Array([(this._rect.right-.5*t)/(.5*t),(this._rect.up-.5*e)/(.5*e),(this._rect.left-.5*t)/(.5*t),(this._rect.up-.5*e)/(.5*e),(this._rect.left-.5*t)/(.5*t),(this._rect.down-.5*e)/(.5*e),(this._rect.right-.5*t)/(.5*t),(this._rect.down-.5*e)/(.5*e)]),this._vertexBuffer=bt.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=bt.createBuffer(),this._firstDraw=!1}bt.bindBuffer(bt.ARRAY_BUFFER,this._uvBuffer),bt.bufferData(bt.ARRAY_BUFFER,this._uvArray,bt.STATIC_DRAW),bt.vertexAttribPointer(null!==(e=this._uvLocation)&&void 0!==e?e:0,2,bt.FLOAT,!1,0,0),bt.bindBuffer(bt.ARRAY_BUFFER,this._vertexBuffer),bt.bufferData(bt.ARRAY_BUFFER,this._positionArray,bt.STATIC_DRAW),bt.vertexAttribPointer(null!==(i=this._positionLocation)&&void 0!==i?i:0,2,bt.FLOAT,!1,0,0),bt.bindBuffer(bt.ELEMENT_ARRAY_BUFFER,this._indexBuffer),bt.bufferData(bt.ELEMENT_ARRAY_BUFFER,this._indexArray,bt.DYNAMIC_DRAW),bt.bindTexture(bt.TEXTURE_2D,this._texture),bt.drawElements(bt.TRIANGLES,null!==(r=null===(s=this._indexArray)||void 0===s?void 0:s.length)&&void 0!==r?r:0,bt.UNSIGNED_SHORT,0)}}isHit(t,e){if(!St)return!1;if(!this._rect)return!1;const{height:i}=St,r=i-e;return t>=this._rect.left&&t<=this._rect.right&&r<=this._rect.up&&r>=this._rect.down}}class bs{constructor(){ys(this,"left",void 0),ys(this,"right",void 0),ys(this,"up",void 0),ys(this,"down",void 0),this.left=0,this.right=0,this.up=0,this.down=0}}function xs(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Cs{constructor(){xs(this,"_startY",void 0),xs(this,"_startX",void 0),xs(this,"_lastX",void 0),xs(this,"_lastY",void 0),xs(this,"_lastX1",void 0),xs(this,"_lastY1",void 0),xs(this,"_lastX2",void 0),xs(this,"_lastY2",void 0),xs(this,"_lastTouchDistance",void 0),xs(this,"_deltaX",void 0),xs(this,"_deltaY",void 0),xs(this,"_scale",void 0),xs(this,"_touchSingle",void 0),xs(this,"_flipAvailable",void 0),this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,r){return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,r=Math.abs(t),s=Math.abs(e);return i*(r<s?r:s)}}function Ps(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Ms{constructor(){Ps(this,"_touchManager",void 0),Ps(this,"_deviceToScreen",void 0),Ps(this,"_viewMatrix",void 0),Ps(this,"_programId",void 0),Ps(this,"_back",void 0),this._programId=null,this._back=null,this._touchManager=new Cs,this._deviceToScreen=new S,this._viewMatrix=new vs}initialize(){var t,e,i,r,s,a,n;if(!St)return;const{width:o,height:l}=St,u=o/l,h=-u,d=u;if(null===(t=this._viewMatrix)||void 0===t||t.setScreenRect(h,d,-1,1),null===(e=this._viewMatrix)||void 0===e||e.scale(1,1),null===(i=this._deviceToScreen)||void 0===i||i.loadIdentity(),o>l){var g;const t=Math.abs(d-h);null===(g=this._deviceToScreen)||void 0===g||g.scaleRelative(t/o,-t/o)}else{var c;const t=Math.abs(2);null===(c=this._deviceToScreen)||void 0===c||c.scaleRelative(t/l,-t/l)}null===(r=this._deviceToScreen)||void 0===r||r.translateRelative(.5*-o,.5*-l),null===(s=this._viewMatrix)||void 0===s||s.setMaxScale(2),null===(a=this._viewMatrix)||void 0===a||a.setMinScale(.8),null===(n=this._viewMatrix)||void 0===n||n.setMaxScreenRect(-2,2,-2,2)}release(){var t;this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,null===(t=this._back)||void 0===t||t.release(),this._back=null,null==bt||bt.deleteProgram(this._programId),this._programId=null}render(){var t;null==bt||bt.useProgram(this._programId),this._programId&&(null===(t=this._back)||void 0===t||t.render(this._programId)),null==bt||bt.flush();const e=cs.getInstance();this._viewMatrix&&e.setViewMatrix(this._viewMatrix),e.onUpdate()}initializeSprite(){if(!St)return;const t=St.width,e=St.height,i=Ts.getInstance().getTextureManager(),r=pt||_t+mt||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=";null==i||i.createTextureFromPngFile(r,!1,(i=>{const r=.5*t,s=.5*e,a=i.width,n=i.height;let o,l;t/e<a/n?(l=e,o=a*(e/n)):(o=t,l=n*(t/a)),i.id&&(this._back=new Ss(r,s,o,l,i.id))})),null==this._programId&&(this._programId=Ts.getInstance().createShader())}onTouchesBegan(t,e){var i;null===(i=this._touchManager)||void 0===i||i.touchesBegan(t*window.devicePixelRatio,e*window.devicePixelRatio)}onTouchesMoved(t,e){if(!this._touchManager)return;const i=this.transformViewX(this._touchManager.getX()),r=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(t*window.devicePixelRatio,e*window.devicePixelRatio),cs.getInstance().onDrag(i,r)}onTouchesEnded(t,e){const i=cs.getInstance();if(i.onDrag(0,0),this._deviceToScreen&&this._touchManager){const t=this._deviceToScreen.transformX(this._touchManager.getX()),e=this._deviceToScreen.transformY(this._touchManager.getY());i.onTap(t,e)}}transformViewX(t){var e,i,r,s;const a=null!==(e=null===(i=this._deviceToScreen)||void 0===i?void 0:i.transformX(t))&&void 0!==e?e:0;return null!==(r=null===(s=this._viewMatrix)||void 0===s?void 0:s.invertTransformX(a))&&void 0!==r?r:0}transformViewY(t){var e,i,r,s;const a=null!==(e=null===(i=this._deviceToScreen)||void 0===i?void 0:i.transformY(t))&&void 0!==e?e:0;return null!==(r=null===(s=this._viewMatrix)||void 0===s?void 0:s.invertTransformY(a))&&void 0!==r?r:0}transformScreenX(t){var e,i;return null!==(e=null===(i=this._deviceToScreen)||void 0===i?void 0:i.transformX(t))&&void 0!==e?e:0}transformScreenY(t){var e,i;return null!==(e=null===(i=this._deviceToScreen)||void 0===i?void 0:i.transformY(t))&&void 0!==e?e:0}resetTranslate(){var t;return null===(t=this._viewMatrix)||void 0===t?void 0:t.resetTranslate()}adjustTranslate(t,e){var i;return null===(i=this._viewMatrix)||void 0===i?void 0:i.adjustTranslate(t,e)}resetScale(){var t;return null===(t=this._viewMatrix)||void 0===t?void 0:t.resetScale()}adjustScale(t){var e,i,r;return null===(e=this._viewMatrix)||void 0===e?void 0:e.adjustScale(null===(i=this._viewMatrix)||void 0===i?void 0:i.getTranslateX(),null===(r=this._viewMatrix)||void 0===r?void 0:r.getTranslateY(),t)}}function ws(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let Bs,Is=null;class Ts{static getInstance(){return null==Is&&(Is=new Ts),Is}static releaseInstance(){null!=Is&&Is.release(),Is=null}initialize(t){return!!this._inited||!!St&&(!!this._view&&(t&&t.appendChild(St),!!bt&&(this._resizeCanvas(),Bs||(Bs=bt.getParameter(bt.FRAMEBUFFER_BINDING)),bt.enable(bt.BLEND),bt.blendFunc(bt.SRC_ALPHA,bt.ONE_MINUS_SRC_ALPHA),"ontouchend"in St?(St.addEventListener("touchstart",Rs,{passive:!0}),St.addEventListener("touchmove",As,{passive:!0}),St.addEventListener("touchend",Ls,{passive:!0}),St.addEventListener("touchcancel",Ds,{passive:!0})):(St.addEventListener("mousedown",Vs,{passive:!0}),St.addEventListener("mousemove",Fs,{passive:!0}),St.addEventListener("mouseup",Es,{passive:!0})),this._view.initialize(),this.initializeCubism(),this._inited=!0,!0)))}onResize(){var t,e;this._resizeCanvas(),null===(t=this._view)||void 0===t||t.initialize(),null===(e=this._view)||void 0===e||e.initializeSprite()}release(){var t,e;null===(t=this._textureManager)||void 0===t||t.release(),this._textureManager=null,null===(e=this._view)||void 0===e||e.release(),this._view=null,cs.releaseInstance(),ht.dispose(),this._inited=!1}run(){const t=()=>{var e;null!=Is&&bt&&(es.updateTime(),bt.clearColor(0,0,0,1),bt.enable(bt.DEPTH_TEST),bt.depthFunc(bt.LEQUAL),bt.clear(bt.COLOR_BUFFER_BIT|bt.DEPTH_BUFFER_BIT),bt.clearDepth(1),bt.enable(bt.BLEND),bt.blendFunc(bt.SRC_ALPHA,bt.ONE_MINUS_SRC_ALPHA),null===(e=this._view)||void 0===e||e.render(),requestAnimationFrame(t))};t()}createShader(){if(!bt)return null;const t=bt.createShader(bt.VERTEX_SHADER);if(null==t)return es.printMessage("failed to create vertexShader"),null;bt.shaderSource(t,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),bt.compileShader(t);const e=bt.createShader(bt.FRAGMENT_SHADER);if(null==e)return es.printMessage("failed to create fragmentShader"),null;bt.shaderSource(e,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),bt.compileShader(e);const i=bt.createProgram();return i?(bt.attachShader(i,t),bt.attachShader(i,e),bt.deleteShader(t),bt.deleteShader(e),bt.linkProgram(i),bt.useProgram(i),i):null}getView(){return this._view}getTextureManager(){return this._textureManager}constructor(){ws(this,"_cubismOption",void 0),ws(this,"_view",void 0),ws(this,"_captured",void 0),ws(this,"_mouseX",void 0),ws(this,"_mouseY",void 0),ws(this,"_isEnd",void 0),ws(this,"_textureManager",void 0),ws(this,"_inited",!1),this._captured=!1,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._cubismOption=new dt,this._view=new Ms,this._textureManager=new ms}initializeCubism(){var t;this._cubismOption.logFunction=es.printMessage,this._cubismOption.loggingLevel=yt,ht.startUp(this._cubismOption),ht.initialize(),cs.getInstance(),es.updateTime(),null===(t=this._view)||void 0===t||t.initializeSprite()}_resizeCanvas(){St&&bt&&(St.width=St.clientWidth*window.devicePixelRatio,St.height=St.clientHeight*window.devicePixelRatio,bt.viewport(0,0,bt.drawingBufferWidth,bt.drawingBufferHeight))}}function Vs(t){var e;if(!Ts.getInstance()._view)return void es.printMessage("view notfound");Ts.getInstance()._captured=!0;const i=t.pageX,r=t.pageY;null===(e=Ts.getInstance()._view)||void 0===e||e.onTouchesBegan(i,r)}function Fs(t){var e;if(!Ts.getInstance()._captured)return;if(!Ts.getInstance()._view)return void es.printMessage("view notfound");const i=t.target.getBoundingClientRect(),r=t.clientX-i.left,s=t.clientY-i.top;null===(e=Ts.getInstance()._view)||void 0===e||e.onTouchesMoved(r,s)}function Es(t){var e;if(Ts.getInstance()._captured=!1,!Ts.getInstance()._view)return void es.printMessage("view notfound");const i=t.target.getBoundingClientRect(),r=t.clientX-i.left,s=t.clientY-i.top;null===(e=Ts.getInstance()._view)||void 0===e||e.onTouchesEnded(r,s)}function Rs(t){var e;if(!Ts.getInstance()._view)return void es.printMessage("view notfound");Ts.getInstance()._captured=!0;const i=t.changedTouches[0].pageX,r=t.changedTouches[0].pageY;null===(e=Ts.getInstance()._view)||void 0===e||e.onTouchesBegan(i,r)}function As(t){var e;if(!Ts.getInstance()._captured)return;if(!Ts.getInstance()._view)return void es.printMessage("view notfound");const i=t.target.getBoundingClientRect(),r=t.changedTouches[0].clientX-i.left,s=t.changedTouches[0].clientY-i.top;null===(e=Ts.getInstance()._view)||void 0===e||e.onTouchesMoved(r,s)}function Ls(t){var e;if(Ts.getInstance()._captured=!1,!Ts.getInstance()._view)return void es.printMessage("view notfound");const i=t.target.getBoundingClientRect(),r=t.changedTouches[0].clientX-i.left,s=t.changedTouches[0].clientY-i.top;null===(e=Ts.getInstance()._view)||void 0===e||e.onTouchesEnded(r,s)}function Ds(t){var e;if(Ts.getInstance()._captured=!1,!Ts.getInstance()._view)return void es.printMessage("view notfound");const i=t.target.getBoundingClientRect(),r=t.changedTouches[0].clientX-i.left,s=t.changedTouches[0].clientY-i.top;null===(e=Ts.getInstance()._view)||void 0===e||e.onTouchesEnded(r,s)}let ks=!1;window.addEventListener("beforeunload",(()=>{if(ks)return Ts.releaseInstance()}),{passive:!0}),window.addEventListener("resize",(()=>{ks&&Ts.getInstance().onResize()}),{passive:!0});const Os=t=>{const[e,i]=(0,r.useState)(!1),[s,a]=(0,r.useState)("pending"),n=(0,r.useMemo)((()=>(e,i)=>{var r;P(i.name),null===(r=t.onModelMotionStart)||void 0===r||r.call(t,e,i)}),[t]),o=(0,r.useMemo)((()=>(e,i)=>{var r;P(""),null===(r=t.onModelMotionEnd)||void 0===r||r.call(t,e,i)}),[t]),l=(0,r.useMemo)((()=>(e,i)=>{var r;w(i.id),null===(r=t.onModelExpression)||void 0===r||r.call(t,e,i)}),[t]),[u,h]=(0,r.useState)(),[d,g]=(0,r.useState)(),[c,_]=(0,r.useState)(),[m,p]=(0,r.useState)(),[f,v]=(0,r.useState)(),[y,S]=(0,r.useState)(),[b,x]=(0,r.useState)(),[C,P]=(0,r.useState)(),[M,w]=(0,r.useState)(),B=(0,r.useCallback)((()=>{e||(t.canvasElementRef&&(t.canvasElement=t.canvasElementRef.current||void 0),t.containerRef&&(t.container=t.containerRef.current||void 0),function({canvasElement:t,container:e,basePath:i="./Resources/",backgroundImageFileName:r="",backgroundImageUrl:s=""}){if(!t&&!e)throw new Error("请提供 `canvasElement` 或 `container`");if(_t=i,mt=r,pt=s,Ct.getInstance(t)&&Ts.getInstance().initialize(e))ks=!0,Ts.getInstance().run()}(t),setTimeout((()=>{window.dispatchEvent(new Event("resize")),i(!0)})))}),[t,e]),I=(0,r.useCallback)((t=>m?(S([]),x([]),a("loading"),null==m?void 0:m.loadModel(t).then((t=>{const e=[];v(t),"function"==typeof n&&(t.onMotionStart=n),"function"==typeof o&&(t.onMotionEnd=o),"function"==typeof l&&(t.onExpression=l);const i=t._modelSetting;i&&([...Array(i.getMotionGroupCount()).keys()].forEach((t=>{const r=i.getMotionGroupName(t),s=i.getMotionCount(r);[...Array(s).keys()].forEach((t=>{const i=`${r}_${t}`;e.push({name:i,group:r,index:t})}))})),S(e),x([...Array(i.getExpressionCount()).keys()].map((t=>i.getExpressionName(t)))))})).catch((t=>{a("error"),console.error(t)}))):Promise.reject("Live2D not initialized")),[m,o,n,l]),T=(0,r.useRef)((()=>{var t;null==f||f.releaseMotions(),null==f||f.releaseExpressions(),null==Ct||Ct.releaseInstance(),null==Ts||Ts.releaseInstance(),null==ss||ss.releaseInstance(),null==cs||null===(t=cs.getInstance())||void 0===t||t.releaseAllModel(),null==cs||cs.releaseInstance(),h(void 0),g(void 0),_(void 0),p(void 0),v(void 0),S([]),x([]),P(""),a("pending"),i(!1)})),V=(0,r.useCallback)((()=>{T.current()}),[]);return(0,r.useEffect)((()=>{if(!e)return;const t=Ts.getInstance();return h(Ct.getInstance()),g(t),t._view&&_(t._view),p(cs.getInstance()),()=>{V()}}),[e,V]),(0,r.useEffect)((()=>{a(f?"ready":"pending")}),[f]),{isInitialized:e,modelState:s,webGL:u,app:d,view:c,live2D:m,model:f,modelMotionList:y,modelExpressionList:b,currentModelMotionName:C,currentModelExpressionId:M,initialize:B,release:V,loadModel:I}};var Ns=i(4127);const js=["Haru","Hiyori","Mao","Mark","Natori","Rice","Wanko"],zs=(0,s.A)({styles:{wrapper:"ee90fb",css:'.ee90fb{background:no-repeat 50%;background-size:cover;height:100dvh;overflow:hidden;position:relative;width:100dvw}.ee90fb canvas{background:#fff;height:100%;left:0;position:absolute;top:0;width:100%;z-index:1}.ee90fb .controls{--font-size:16px;--line-height:calc(var(--font-size)*1.5);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);background:rgba(0,0,0,.25);color:#fff;display:inline-block;font-size:var(--font-size);height:100%;left:0;line-height:var(--line-height);overflow:auto;padding:1em;position:fixed;top:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:240px;z-index:2}.ee90fb .controls button{background:hsla(0,0%,100%,.175);border:1px solid hsla(0,0%,100%,.25);border-radius:10em;box-shadow:0 1px 4px 1px rgba(0,0,0,.15);color:#fff;cursor:pointer;display:inline-block;font-size:inherit;line-height:inherit;padding:0 .75em;transition:background-color .15s ease-out}.ee90fb .controls button:focus,.ee90fb .controls button:hover{background:hsla(0,0%,100%,.25)}.ee90fb .controls button:active{background:rgba(0,0,0,.15)}.ee90fb .controls button.is-active{background:#080}.ee90fb .controls button.mod-round{overflow:hidden;padding:0;width:var(--line-height)}.ee90fb .controls .empty{color:hsla(0,0%,100%,.5);display:inline-block}.ee90fb .controls dl{--title-width:2.5em;--gutter:5px;--item-margin:10px;display:block;margin:0;padding:0;padding-left:calc(var(--title-width) + var(--gutter));position:relative;width:100%}.ee90fb .controls dl,.ee90fb .controls dl dd,.ee90fb .controls dl dd>*,.ee90fb .controls dl dt{font-size:inherit;line-height:inherit}.ee90fb .controls dl dt{color:hsla(0,0%,100%,.75);display:block;height:var(--line-height);left:0;margin-left:calc(var(--title-width)*-1 - var(--gutter));overflow:visible;position:-webkit-sticky;position:sticky;top:0;width:var(--title-width)}.ee90fb .controls dl dd{display:block;margin:calc(var(--item-margin)*-1 - var(--line-height)) 0 0 0}.ee90fb .controls dl dd>*{margin:var(--item-margin) var(--item-margin) 0 0}.ee90fb .controls dl dd select{width:100%}.ee90fb .controls dl+dl{margin-top:2em;padding-top:2em}.ee90fb .controls dl+dl:before{background:hsla(0,0%,100%,.15);content:"";height:2px;left:0;position:absolute;top:0;width:100%}.ee90fb .controls dl.is-position dd{--unit:calc(var(--line-height) + var(--item-margin));height:calc(var(--unit)*3);position:relative}.ee90fb .controls dl.is-position dd button{margin:0;position:absolute}.ee90fb .controls dl.is-position dd .is-up{left:calc(var(--unit));top:var(--item-margin)}.ee90fb .controls dl.is-position dd .is-down{left:calc(var(--unit)*1);top:calc(var(--unit)*2 + var(--item-margin))}.ee90fb .controls dl.is-position dd .is-left{left:0;top:calc(var(--unit)*1 + var(--item-margin))}.ee90fb .controls dl.is-position dd .is-right{left:calc(var(--unit)*2);top:calc(var(--unit)*1 + var(--item-margin))}.ee90fb .controls dl.is-position dd .is-reset{left:calc(var(--unit)*1);top:calc(var(--unit)*1 + var(--item-margin))}.ee90fb .controls dl.is-scale dd{--unit:calc(var(--line-height) + var(--item-margin));height:calc(var(--unit)*1);position:relative}.ee90fb .controls dl.is-scale dd button{margin:0;position:absolute}.ee90fb .controls dl.is-scale dd .is-up{left:0;top:var(--item-margin)}.ee90fb .controls dl.is-scale dd .is-down{left:calc(var(--unit)*2);top:var(--item-margin)}.ee90fb .controls dl.is-scale dd .is-reset{left:calc(var(--unit)*1);top:var(--item-margin)}.ee90fb .controls.is-model-state-ready{padding-bottom:2.5em;padding-top:2.5em}'}})((({className:t})=>{const e=(0,r.useRef)(null),{isInitialized:s,modelState:a,webGL:o,app:l,view:u,live2D:h,model:d,modelMotionList:g,modelExpressionList:c,currentModelMotionName:_,currentModelExpressionId:m,initialize:p,release:f,loadModel:v}=Os({containerRef:e,basePath:"./Resources/",backgroundImageUrl:i(5998)}),y=(0,r.useCallback)((t=>{if(!d)return;const e=t.target.getAttribute("data-group"),i=t.target.getAttribute("data-index");d.startMotion(e,Number(i),3)}),[d]),S=(0,r.useCallback)((t=>{d&&d.setExpression(t.target.getAttribute("data-value"))}),[d]),b=(0,r.useCallback)((t=>{switch(t.target.getAttribute("data-direction")){case"reset":return null==u?void 0:u.resetTranslate();case"up":return null==u?void 0:u.adjustTranslate(0,.1);case"right":return null==u?void 0:u.adjustTranslate(.1,0);case"down":return null==u?void 0:u.adjustTranslate(0,-.1);case"left":return null==u?void 0:u.adjustTranslate(-.1,0)}}),[u]),x=(0,r.useCallback)((t=>{switch(t.target.getAttribute("data-scale")){case"reset":return null==u?void 0:u.resetScale();case"up":return null==u?void 0:u.adjustScale(1.1);case"down":return null==u?void 0:u.adjustScale(.9)}}),[u]),C=(0,r.useCallback)((t=>{v(t.target.getAttribute("data-model-name"))}),[v]);return(0,r.useEffect)((()=>{e.current&&p()}),[p]),(0,r.useEffect)((()=>{d&&Array.isArray(c)&&d.setExpression(c[0])}),[d,c]),(0,Ns.jsx)("div",{className:t,ref:e,children:(0,Ns.jsx)("div",{className:n()(["controls",`is-model-state-${a}`]),children:"pending"===a?(0,Ns.jsx)(Ns.Fragment,{children:(0,Ns.jsxs)("dl",{children:[(0,Ns.jsx)("dt",{children:"选择"}),(0,Ns.jsx)("dd",{children:js.map(((t,e)=>(0,Ns.jsxs)(r.Fragment,{children:[(0,Ns.jsx)("button",{onClick:C,"data-model-name":t,children:t}),(0,Ns.jsx)("br",{})]},e)))})]})}):d?(0,Ns.jsxs)(Ns.Fragment,{children:[(0,Ns.jsxs)("dl",{children:[(0,Ns.jsx)("dt",{children:"模型"}),(0,Ns.jsx)("dd",{children:(0,Ns.jsx)("button",{onClick:f,children:"释放"})})]}),(0,Ns.jsxs)("dl",{className:"is-position",children:[(0,Ns.jsx)("dt",{children:"位置"}),(0,Ns.jsxs)("dd",{children:[(0,Ns.jsx)("button",{className:"mod-round is-reset",onClick:b,"data-direction":"reset",children:"↺"}),(0,Ns.jsx)("button",{className:"mod-round is-up",onClick:b,"data-direction":"up",children:"↑"}),(0,Ns.jsx)("button",{className:"mod-round is-right",onClick:b,"data-direction":"right",children:"→"}),(0,Ns.jsx)("button",{className:"mod-round is-down",onClick:b,"data-direction":"down",children:"↓"}),(0,Ns.jsx)("button",{className:"mod-round is-left",onClick:b,"data-direction":"left",children:"←"})]})]}),(0,Ns.jsxs)("dl",{className:"is-scale",children:[(0,Ns.jsx)("dt",{children:"缩放"}),(0,Ns.jsxs)("dd",{children:[(0,Ns.jsx)("button",{className:"mod-round is-reset",onClick:x,"data-scale":"reset",children:"↺"}),(0,Ns.jsx)("button",{className:"mod-round is-up",onClick:x,"data-scale":"up",children:"+"}),(0,Ns.jsx)("button",{className:"mod-round is-down",onClick:x,"data-scale":"down",children:"−"})]})]}),(0,Ns.jsxs)("dl",{children:[(0,Ns.jsx)("dt",{children:"动作"}),(0,Ns.jsx)("dd",{children:null!=g&&g.length?null==g?void 0:g.map(((t,e)=>(0,Ns.jsx)("button",{className:t.name===_?"is-active":"",onClick:y,"data-group":t.group,"data-index":t.index,children:t.name},e))):(0,Ns.jsx)("span",{className:"empty",children:"无"})})]}),(0,Ns.jsxs)("dl",{children:[(0,Ns.jsx)("dt",{children:"表情"}),(0,Ns.jsx)("dd",{children:null!=c&&c.length?null==c?void 0:c.map(((t,e)=>(0,Ns.jsx)("button",{className:t===m?"is-active":"",onClick:S,"data-value":t,children:t},e))):(0,Ns.jsx)("span",{className:"empty",children:"无"})})]}),(0,Ns.jsxs)("dl",{children:[(0,Ns.jsx)("dt",{children:"TIPS"}),(0,Ns.jsx)("dd",{children:(0,Ns.jsxs)("ul",{children:[(0,Ns.jsx)("li",{children:"点按身躯可随机更换动作"}),(0,Ns.jsx)("li",{children:"点按面部可随机更换表情"}),(0,Ns.jsx)("li",{children:"按住并拖拽可改变面部朝向"})]})})]})]}):(0,Ns.jsx)(Ns.Fragment,{children:"载入中..."})})})})),Us={path:"/",component:(0,s.A)({styles:{wrapper:"aa8540",css:".aa8540{border-top:40px solid transparent;position:relative}.aa8540>main{border-bottom:30px solid transparent;border-top:30px solid transparent}.aa8540>main .link-style,.aa8540>main a{color:#0288d1;display:inline-block;line-height:1em;text-decoration:none}.aa8540>main .link-style .icon,.aa8540>main a .icon{height:16px;vertical-align:bottom;width:16px}.aa8540>main .link-style:hover,.aa8540>main a:hover{color:#000}.aa8540>main .link-style:active,.aa8540>main a:active{color:#a6a6a6}.aa8540>main button.link-style{cursor:pointer}.aa8540.is-home{border-top-color:#0288d1}.aa8540.is-home>main{border-top-width:0}"}})((({className:t,children:e,location:i,...s})=>(0,Ns.jsx)(r.StrictMode,{children:(0,Ns.jsx)(zs,{})})))}},5998:(t,e,i)=>{t.exports=i.p+"includes/asset.38f1643a79396c5340d0.jpg"}},i={};function r(t){var s=i[t];if(void 0!==s)return s.exports;var a=i[t]={id:t,loaded:!1,exports:{}};return e[t](a,a.exports,r),a.loaded=!0,a.exports}r.m=e,t=[],r.O=(e,i,s,a)=>{if(!i){var n=1/0;for(h=0;h<t.length;h++){for(var[i,s,a]=t[h],o=!0,l=0;l<i.length;l++)(!1&a||n>=a)&&Object.keys(r.O).every((t=>r.O[t](i[l])))?i.splice(l--,1):(o=!1,a<n&&(n=a));if(o){t.splice(h--,1);var u=s();void 0!==u&&(e=u)}}return e}a=a||0;for(var h=t.length;h>0&&t[h-1][2]>a;h--)t[h]=t[h-1];t[h]=[i,s,a]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),r.p="",(()=>{var t={818:0};r.O.j=e=>0===t[e];var e=(e,i)=>{var s,a,[n,o,l]=i,u=0;if(n.some((e=>0!==t[e]))){for(s in o)r.o(o,s)&&(r.m[s]=o[s]);if(l)var h=l(r)}for(e&&e(i);u<n.length;u++)a=n[u],r.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return r.O(h)},i=self.webpackChunkux_live2d_demo=self.webpackChunkux_live2d_demo||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var s=r.O(void 0,[674,250],(()=>r(2185)));s=r.O(s)})();